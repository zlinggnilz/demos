import{r as $,j as cs}from"./index-fb03fb25.js";import{V as X,aQ as ls,l as nt,M as E,T as ds,a2 as us,a1 as ps,Q as vs,aR as fs,a8 as ms,aS as Se,aO as ws,m as gs,aT as ys,i as Qe,P as Es,ad as Je,h as bs,W as _s,F as Ts,aU as Os,aV as Ms,S as Ls}from"./three.module-aafafa83.js";/*!
 * PhotoSphereViewer 5.4.2
 * @copyright 2014-2015 Jérémy Heleine
 * @copyright 2023 Damien "Mistic" Sorel
 * @licence MIT (https://opensource.org/licenses/MIT)
 */var xs=Object.defineProperty,We=(e,t)=>{for(var i in t)xs(e,i,{get:t[i],enumerable:!0})},Cs={};We(Cs,{ACTIONS:()=>vt,ANIMATION_MIN_DURATION:()=>ht,CAPTURE_EVENTS_CLASS:()=>he,CTRLZOOM_TIMEOUT:()=>pt,DBLCLICK_DELAY:()=>lt,DEFAULT_TRANSITION:()=>at,EASINGS:()=>ve,ICONS:()=>I,IDS:()=>T,INERTIA_WINDOW:()=>Ie,KEY_CODES:()=>b,LONGTOUCH_DELAY:()=>dt,MOVE_THRESHOLD:()=>ct,SPHERE_RADIUS:()=>ae,TWOFINGERSOVERLAY_DELAY:()=>ut,VIEWER_DATA:()=>j});var Ss=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="40 40 432 432"><g transform="rotate(0, 256, 256)"><path fill="currentColor" d="M425.23 210.55H227.39a5 5 0 01-3.53-8.53l56.56-56.57a45.5 45.5 0 000-64.28 45.15 45.15 0 00-32.13-13.3 45.15 45.15 0 00-32.14 13.3L41.32 256l174.83 174.83a45.15 45.15 0 0032.14 13.3 45.15 45.15 0 0032.13-13.3 45.5 45.5 0 000-64.28l-56.57-56.57a5 5 0 013.54-8.53h197.84c25.06 0 45.45-20.39 45.45-45.45s-20.4-45.45-45.45-45.45z"/></g><!-- Created by Flatart from the Noun Project --></svg>
`,Is='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g fill="currentColor" transform=" translate(50, 50) rotate(45)"><rect x="-5" y="-65" width="10" height="130"/><rect x="-65" y="-5" width="130" height="10"/></g></svg>',ks=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="currentColor" d="M83.3 35.6h-17V3H32.2v32.6H16.6l33.6 32.7 33-32.7z"/><path fill="currentColor" d="M83.3 64.2v16.3H16.6V64.2H-.1v32.6H100V64.2H83.3z"/><!--Created by Michael Zenaty from the Noun Project--></svg>
`,Rs=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="currentColor" d="M100 40H87.1V18.8h-21V6H100zM100 93.2H66V80.3h21.1v-21H100zM34 93.2H0v-34h12.9v21.1h21zM12.9 40H0V6h34v12.9H12.8z"/><!--Created by Garrett Knoll from the Noun Project--></svg>
`,As=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="currentColor" d="M66 7h13v21h21v13H66zM66 60.3h34v12.9H79v21H66zM0 60.3h34v34H21V73.1H0zM21 7h13v34H0V28h21z"/><!--Created by Garrett Knoll from the Noun Project--></svg>
`,Hs=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><path fill="currentColor" d="M28.3 26.1c-1 2.6-1.9 4.8-2.6 7-2.5 7.4-5 14.7-7.2 22-1.3 4.4.5 7.2 4.3 7.8 1.3.2 2.8.2 4.2-.1 8.2-2 11.9-8.6 15.7-15.2l-2.2 2a18.8 18.8 0 0 1-7.4 5.2 2 2 0 0 1-1.6-.2c-.2-.1 0-1 0-1.4l.8-1.8L41.9 28c.5-1.4.9-3 .7-4.4-.2-2.6-3-4.4-6.3-4.4-8.8.2-15 4.5-19.5 11.8-.2.3-.2.6-.3 1.3 3.7-2.8 6.8-6.1 11.8-6.2z"/><circle fill="currentColor" cx="39.3" cy="9.2" r="8.2"/><!--Created by Arafat Uddin from the Noun Project--></svg>
`,Ps=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="10 10 80 80"><g fill="currentColor"><circle r="10" cx="20" cy="20"/><circle r="10" cx="50" cy="20"/><circle r="10" cx="80" cy="20"/><circle r="10" cx="20" cy="50"/><circle r="10" cx="50" cy="50"/><circle r="10" cx="80" cy="50"/><circle r="10" cx="20" cy="80"/><circle r="10" cx="50" cy="80"/><circle r="10" cx="80" cy="80"/></g><!-- Created by Richard Kunák from the Noun Project--></svg>
`,zs=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path fill="currentColor" d="M14.043 12.22a7.738 7.738 0 1 0-1.823 1.822l4.985 4.985c.503.504 1.32.504 1.822 0a1.285 1.285 0 0 0 0-1.822l-4.984-4.985zm-6.305 1.043a5.527 5.527 0 1 1 0-11.053 5.527 5.527 0 0 1 0 11.053z"/><path fill="currentColor" d="M8.728 4.009H6.744v2.737H4.006V8.73h2.738v2.736h1.984V8.73h2.737V6.746H8.728z"/><!--Created by Ryan Canning from the Noun Project--></svg>
`,Ns=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path fill="currentColor" d="M14.043 12.22a7.738 7.738 0 1 0-1.823 1.822l4.985 4.985c.503.504 1.32.504 1.822 0a1.285 1.285 0 0 0 0-1.822l-4.984-4.985zm-6.305 1.043a5.527 5.527 0 1 1 0-11.053 5.527 5.527 0 0 1 0 11.053z"/><path fill="currentColor" d="M4.006 6.746h7.459V8.73H4.006z"/><!--Created by Ryan Canning from the Noun Project--></svg>
`,at=1500,ht=500,ct=4,lt=300,dt=500,ut=100,pt=2e3,Ie=300,ae=10,j="photoSphereViewer",he="psv--capture-event",vt=(e=>(e.ROTATE_UP="ROTATE_UP",e.ROTATE_DOWN="ROTATE_DOWN",e.ROTATE_RIGHT="ROTATE_RIGHT",e.ROTATE_LEFT="ROTATE_LEFT",e.ZOOM_IN="ZOOM_IN",e.ZOOM_OUT="ZOOM_OUT",e))(vt||{}),T={MENU:"menu",TWO_FINGERS:"twoFingers",CTRL_ZOOM:"ctrlZoom",ERROR:"error",DESCRIPTION:"description"},b={Enter:"Enter",Control:"Control",Escape:"Escape",Space:" ",PageUp:"PageUp",PageDown:"PageDown",ArrowLeft:"ArrowLeft",ArrowUp:"ArrowUp",ArrowRight:"ArrowRight",ArrowDown:"ArrowDown",Delete:"Delete",Plus:"+",Minus:"-"},I={arrow:Ss,close:Is,download:ks,fullscreenIn:Rs,fullscreenOut:As,info:Hs,menu:Ps,zoomIn:zs,zoomOut:Ns},ve={linear:e=>e,inQuad:e=>e*e,outQuad:e=>e*(2-e),inOutQuad:e=>e<.5?2*e*e:-1+(4-2*e)*e,inCubic:e=>e*e*e,outCubic:e=>--e*e*e+1,inOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,inQuart:e=>e*e*e*e,outQuart:e=>1- --e*e*e*e,inOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,inQuint:e=>e*e*e*e*e,outQuint:e=>1+--e*e*e*e*e,inOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,inSine:e=>1-Math.cos(e*(Math.PI/2)),outSine:e=>Math.sin(e*(Math.PI/2)),inOutSine:e=>.5-.5*Math.cos(Math.PI*e),inExpo:e=>Math.pow(2,10*(e-1)),outExpo:e=>1-Math.pow(2,-10*e),inOutExpo:e=>(e=e*2-1)<0?.5*Math.pow(2,10*e):1-.5*Math.pow(2,-10*e),inCirc:e=>1-Math.sqrt(1-e*e),outCirc:e=>Math.sqrt(1-(e-1)*(e-1)),inOutCirc:e=>(e*=2)<1?.5-.5*Math.sqrt(1-e*e):.5+.5*Math.sqrt(1-(e-=2)*e)},Us={};We(Us,{Animation:()=>oe,Dynamic:()=>fe,MultiDynamic:()=>Rt,PressHandler:()=>Oe,Slider:()=>Ht,SliderDirection:()=>At,addClasses:()=>je,angle:()=>ft,applyEulerInverse:()=>Pe,checkStylesheet:()=>kt,cleanCssPosition:()=>St,clone:()=>re,createTexture:()=>He,cssPositionIsOrdered:()=>Ge,dasherize:()=>Ys,deepEqual:()=>Lt,deepmerge:()=>Ot,distance:()=>Ye,exitFullscreen:()=>Tt,firstNonNull:()=>k,getAbortError:()=>Re,getAngle:()=>wt,getClosest:()=>Xe,getConfigParser:()=>Te,getElement:()=>gt,getPosition:()=>Et,getShortestArc:()=>mt,getStyle:()=>V,getTouchData:()=>ke,getXMPValue:()=>R,greatArcDistance:()=>Fs,hasParent:()=>yt,invertResolvableBoolean:()=>_e,isAbortError:()=>Ct,isEmpty:()=>Mt,isExtendedPosition:()=>we,isFullscreenEnabled:()=>bt,isNil:()=>S,isPlainObject:()=>$e,logWarn:()=>g,parseAngle:()=>U,parsePoint:()=>js,parseSpeed:()=>It,removeClasses:()=>Ws,requestFullscreen:()=>_t,resolveBoolean:()=>Ze,speedToDuration:()=>Ae,sum:()=>Vs,throttle:()=>Be,toggleClass:()=>be,wrap:()=>q});function q(e,t){let i=e%t;return i<0&&(i+=t),i}function Vs(e){return e.reduce((t,i)=>t+i,0)}function Ye(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function ft(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function mt(e,t){return[0,Math.PI*2,-Math.PI*2].reduce((s,r)=>{const o=t-e+r;return Math.abs(o)<Math.abs(s)?o:s},1/0)}function wt(e,t){return Math.acos(Math.cos(e.pitch)*Math.cos(t.pitch)*Math.cos(e.yaw-t.yaw)+Math.sin(e.pitch)*Math.sin(t.pitch))}function Fs([e,t],[i,s]){const r=(i-e)*Math.cos((t+s)/2),o=s-t;return Math.sqrt(r*r+o*o)}function gt(e){return typeof e=="string"?e.match(/^[a-z]/i)?document.getElementById(e):document.querySelector(e):e}function be(e,t,i){i===void 0?e.classList.toggle(t):i?e.classList.add(t):i||e.classList.remove(t)}function je(e,t){e.classList.add(...t.split(" "))}function Ws(e,t){e.classList.remove(...t.split(" "))}function yt(e,t){let i=e;do{if(i===t)return!0;i=i.parentElement}while(i);return!1}function Xe(e,t){if(!(e!=null&&e.matches))return null;let i=e;do{if(i.matches(t))return i;i=i.parentElement}while(i);return null}function Et(e){let t=0,i=0,s=e;for(;s;)t+=s.offsetLeft-s.scrollLeft+s.clientLeft,i+=s.offsetTop-s.scrollTop+s.clientTop,s=s.offsetParent;return{x:t,y:i}}function V(e,t){return window.getComputedStyle(e,null)[t]}function ke(e){if(e.touches.length<2)return null;const t={x:e.touches[0].clientX,y:e.touches[0].clientY},i={x:e.touches[1].clientX,y:e.touches[1].clientY};return{distance:Ye(t,i),angle:ft(t,i),center:{x:(t.x+i.x)/2,y:(t.y+i.y)/2}}}function bt(e){return(document.fullscreenElement||document.webkitFullscreenElement)===e}function _t(e){(e.requestFullscreen||e.webkitRequestFullscreen).call(e)}function Tt(){(document.exitFullscreen||document.webkitExitFullscreen).call(document)}function Ys(e){return e.replace(/[A-Z](?:(?=[^A-Z])|[A-Z]*(?=[A-Z][^A-Z]|$))/g,(t,i)=>(i>0?"-":"")+t.toLowerCase())}function Be(e,t){let i=!1;return function(...s){i||(i=!0,setTimeout(()=>{e.apply(this,s),i=!1},t))}}function $e(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Ot(e,t){const i=t;return function s(r,o){return Array.isArray(o)?(!r||!Array.isArray(r)?r=[]:r.length=0,o.forEach((n,a)=>{r[a]=s(null,n)})):typeof o=="object"?((!r||Array.isArray(r))&&(r={}),Object.keys(o).forEach(n=>{typeof o[n]!="object"||!o[n]||!$e(o[n])?r[n]=o[n]:o[n]!==i&&(r[n]?s(r[n],o[n]):r[n]=s(null,o[n]))})):r=o,r}(e,t)}function re(e){return Ot(null,e)}function Mt(e){return!e||Object.keys(e).length===0&&e.constructor===Object}function S(e){return e==null}function k(...e){for(const t of e)if(!S(t))return t;return null}function Lt(e,t){if(e===t)return!0;if(et(e)&&et(t)){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i of Object.keys(e))if(!Lt(e[i],t[i]))return!1;return!0}else return!1}function et(e){return typeof e=="object"&&e!==null}var v=class xt extends Error{constructor(t){var i;super(t),this.name="PSVError",(i=Error.captureStackTrace)==null||i.call(Error,this,xt)}};function Ze(e,t){$e(e)?(t(e.initial,!0),e.promise.then(i=>t(i,!1))):t(e,!0)}function _e(e){return{initial:!e.initial,promise:e.promise.then(t=>!t)}}function Re(){const e=new Error("Loading was aborted.");return e.name="AbortError",e}function Ct(e){return(e==null?void 0:e.name)==="AbortError"}function g(e){console.warn(`PhotoSphereViewer: ${e}`)}function we(e){return e?[["textureX","textureY"],["yaw","pitch"]].some(([t,i])=>e[t]!==void 0&&e[i]!==void 0):!1}function R(e,t){let i=e.match("<GPano:"+t+">(.*)</GPano:"+t+">");if(i!==null){const s=parseInt(i[1],10);return isNaN(s)?null:s}if(i=e.match("GPano:"+t+'="(.*?)"'),i!==null){const s=parseInt(i[1],10);return isNaN(s)?null:s}return null}var tt={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},ge=["left","center","right"],ye=["top","center","bottom"],it=[...ge,...ye],x="center";function js(e){if(!e)return{x:.5,y:.5};if(typeof e=="object")return e;let t=e.toLocaleLowerCase().split(" ").slice(0,2);t.length===1&&(tt[t[0]]?t=[t[0],x]:t=[t[0],t[0]]);const i=t[1]!=="left"&&t[1]!=="right"&&t[0]!=="top"&&t[0]!=="bottom";t=t.map(r=>tt[r]||r),i||t.reverse();const s=t.join(" ").match(/^([0-9.]+)% ([0-9.]+)%$/);return s?{x:parseFloat(s[1])/100,y:parseFloat(s[2])/100}:{x:.5,y:.5}}function St(e,{allowCenter:t,cssOrder:i}={allowCenter:!0,cssOrder:!0}){return e?(typeof e=="string"&&(e=e.split(" ")),e.length===1&&(e[0]===x?e=[x,x]:ge.indexOf(e[0])!==-1?e=[x,e[0]]:ye.indexOf(e[0])!==-1&&(e=[e[0],x])),e.length!==2||it.indexOf(e[0])===-1||it.indexOf(e[1])===-1?(g(`Unparsable position ${e}`),null):!t&&e[0]===x&&e[1]===x?(g("Invalid position center center"),null):(i&&!Ge(e)&&(e=[e[1],e[0]]),e[1]===x&&ge.indexOf(e[0])!==-1&&(e=[x,e[0]]),e[0]===x&&ye.indexOf(e[1])!==-1&&(e=[e[1],x]),e)):null}function Ge(e){return ye.indexOf(e[0])!==-1&&ge.indexOf(e[1])!==-1}function It(e){let t;if(typeof e=="string"){const i=e.toString().trim();let s=parseFloat(i.replace(/^(-?[0-9]+(?:\.[0-9]*)?).*$/,"$1"));const r=i.replace(/^-?[0-9]+(?:\.[0-9]*)?(.*)$/,"$1").trim();switch(r.match(/(pm|per minute)$/)&&(s/=60),r){case"dpm":case"degrees per minute":case"dps":case"degrees per second":t=E.degToRad(s);break;case"rdpm":case"radians per minute":case"rdps":case"radians per second":t=s;break;case"rpm":case"revolutions per minute":case"rps":case"revolutions per second":t=s*Math.PI*2;break;default:throw new v(`Unknown speed unit "${r}"`)}}else t=e;return t}function Ae(e,t){if(typeof e!="number"){const i=It(e);return t/Math.abs(i)*1e3}else return Math.abs(e)}function U(e,t=!1,i=t){let s;if(typeof e=="string"){const r=e.toLowerCase().trim().match(/^(-?[0-9]+(?:\.[0-9]*)?)(.*)$/);if(!r)throw new v(`Unknown angle "${e}"`);const o=parseFloat(r[1]),n=r[2];if(n)switch(n){case"deg":case"degs":s=E.degToRad(o);break;case"rad":case"rads":s=o;break;default:throw new v(`Unknown angle unit "${n}"`)}else s=o}else if(typeof e=="number"&&!isNaN(e))s=e;else throw new v(`Unknown angle "${e}"`);return s=q(t?s+Math.PI:s,Math.PI*2),t?E.clamp(s-Math.PI,-Math.PI/(i?2:1),Math.PI/(i?2:1)):s}function He(e,t=!1){const i=new ds(e);return i.needsUpdate=!0,i.minFilter=t?us:ps,i.generateMipmaps=t,i.anisotropy=t?2:1,i}var st=new vs;function Pe(e,t){st.setFromEuler(t).invert(),e.applyQuaternion(st)}function Te(e,t){const i=function(s){if(!s)return re(e);const r=re({...e,...s}),o={};for(let[n,a]of Object.entries(r)){if(t&&n in t)a=t[n](a,{rawConfig:r,defValue:e[n]});else if(!(n in e)){g(`Unknown option ${n}`);continue}o[n]=a}return o};return i.defaults=e,i.parsers=t||{},i}function kt(e,t){window.getComputedStyle(e).getPropertyValue(`--psv-${t}-loaded`)!=="true"&&console.error(`PhotoSphereViewer: stylesheet "@photo-sphere-viewer/${t}/index.css" is not loaded`)}var oe=class{constructor(e){this.easing=ve.linear,this.callbacks=[],this.resolved=!1,this.cancelled=!1,this.options=e,e?(e.easing&&(this.easing=typeof e.easing=="function"?e.easing:ve[e.easing]||ve.linear),this.delayTimeout=setTimeout(()=>{this.delayTimeout=void 0,this.animationFrame=window.requestAnimationFrame(t=>this.__run(t))},e.delay||0)):this.resolved=!0}__run(e){if(this.cancelled)return;this.start||(this.start=e);const t=(e-this.start)/this.options.duration,i={};if(t<1){for(const[s,r]of Object.entries(this.options.properties))if(r){const o=r.start+(r.end-r.start)*this.easing(t);i[s]=o}this.options.onTick(i,t),this.animationFrame=window.requestAnimationFrame(s=>this.__run(s))}else{for(const[s,r]of Object.entries(this.options.properties))r&&(i[s]=r.end);this.options.onTick(i,1),this.__resolve(!0),this.animationFrame=void 0}}__resolve(e){e?this.resolved=!0:this.cancelled=!0,this.callbacks.forEach(t=>t(e)),this.callbacks.length=0}then(e){return this.resolved||this.cancelled?Promise.resolve(this.resolved).then(e):new Promise(t=>{this.callbacks.push(t)}).then(e)}cancel(){!this.cancelled&&!this.resolved&&(this.__resolve(!1),this.delayTimeout&&(window.clearTimeout(this.delayTimeout),this.delayTimeout=void 0),this.animationFrame&&(window.cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0))}},fe=class{constructor(e,t){if(this.fn=e,this.mode=0,this.speed=0,this.speedMult=0,this.currentSpeed=0,this.target=0,this.__current=0,this.min=t.min,this.max=t.max,this.wrap=t.wrap,this.current=t.defaultValue,this.wrap&&this.min!==0)throw new v("invalid config");this.fn&&this.fn(this.current)}get current(){return this.__current}set current(e){this.__current=e}setSpeed(e){this.speed=e}goto(e,t=1){this.mode=2,this.target=this.wrap?q(e,this.max):E.clamp(e,this.min,this.max),this.speedMult=t}step(e,t=1){t===0?this.setValue(this.current+e):(this.mode!==2&&(this.target=this.current),this.goto(this.target+e,t))}roll(e=!1,t=1){this.mode=1,this.target=e?-1/0:1/0,this.speedMult=t}stop(){this.mode=0}setValue(e){return this.target=this.wrap?q(e,this.max):E.clamp(e,this.min,this.max),this.mode=0,this.currentSpeed=0,this.target!==this.current?(this.current=this.target,this.fn&&this.fn(this.current),!0):!1}update(e){if(this.mode===2){this.wrap&&Math.abs(this.target-this.current)>this.max/2&&(this.current=this.current<this.target?this.current+this.max:this.current-this.max);const s=this.currentSpeed*this.currentSpeed/(this.speed*this.speedMult*4);Math.abs(this.target-this.current)<=s&&(this.mode=0)}let t=this.mode===0?0:this.speed*this.speedMult;this.target<this.current&&(t=-t),this.currentSpeed<t?this.currentSpeed=Math.min(t,this.currentSpeed+e/1e3*this.speed*this.speedMult*2):this.currentSpeed>t&&(this.currentSpeed=Math.max(t,this.currentSpeed-e/1e3*this.speed*this.speedMult*2));let i=null;return this.current>this.target&&this.currentSpeed?i=Math.max(this.target,this.current+this.currentSpeed*e/1e3):this.current<this.target&&this.currentSpeed&&(i=Math.min(this.target,this.current+this.currentSpeed*e/1e3)),i!==null&&(i=this.wrap?q(i,this.max):E.clamp(i,this.min,this.max),i!==this.current)?(this.current=i,this.fn&&this.fn(this.current),!0):!1}},Rt=class{constructor(e,t){this.fn=e,this.dynamics=t,this.fn&&this.fn(this.current)}get current(){return Object.entries(this.dynamics).reduce((e,[t,i])=>(e[t]=i.current,e),{})}setSpeed(e){for(const t of Object.values(this.dynamics))t.setSpeed(e)}goto(e,t=1){for(const[i,s]of Object.entries(e))this.dynamics[i].goto(s,t)}step(e,t=1){if(t===0)this.setValue(Object.keys(e).reduce((i,s)=>(i[s]=e[s]+this.dynamics[s].current,i),{}));else for(const[i,s]of Object.entries(e))this.dynamics[i].step(s,t)}roll(e,t=1){for(const[i,s]of Object.entries(e))this.dynamics[i].roll(s,t)}stop(){for(const e of Object.values(this.dynamics))e.stop()}setValue(e){let t=!1;for(const[i,s]of Object.entries(e))t=this.dynamics[i].setValue(s)||t;return t&&this.fn&&this.fn(this.current),t}update(e){let t=!1;for(const i of Object.values(this.dynamics))t=i.update(e)||t;return t&&this.fn&&this.fn(this.current),t}},Oe=class{constructor(e=200){this.delay=e,this.time=0,this.delay=e}get pending(){return this.time!==0}down(){this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.time=new Date().getTime()}up(e){if(!this.time)return;Date.now()-this.time<this.delay?this.timeout=setTimeout(()=>{e(),this.timeout=void 0,this.time=0},this.delay):(e(),this.time=0)}},At=(e=>(e.VERTICAL="VERTICAL",e.HORIZONTAL="HORIZONTAL",e))(At||{}),Ht=class{constructor(e,t,i){this.container=e,this.direction=t,this.listener=i,this.mousedown=!1,this.mouseover=!1,this.container.addEventListener("click",this),this.container.addEventListener("mousedown",this),this.container.addEventListener("mouseenter",this),this.container.addEventListener("mouseleave",this),this.container.addEventListener("touchstart",this),this.container.addEventListener("mousemove",this,!0),this.container.addEventListener("touchmove",this,!0),window.addEventListener("mouseup",this),window.addEventListener("touchend",this)}get isVertical(){return this.direction==="VERTICAL"}get isHorizontal(){return this.direction==="HORIZONTAL"}destroy(){window.removeEventListener("mouseup",this),window.removeEventListener("touchend",this)}handleEvent(e){switch(e.type){case"click":e.stopPropagation();break;case"mousedown":this.__onMouseDown(e);break;case"mouseenter":this.__onMouseEnter(e);break;case"mouseleave":this.__onMouseLeave(e);break;case"touchstart":this.__onTouchStart(e);break;case"mousemove":this.__onMouseMove(e);break;case"touchmove":this.__onTouchMove(e);break;case"mouseup":this.__onMouseUp(e);break;case"touchend":this.__onTouchEnd(e);break}}__onMouseDown(e){this.mousedown=!0,this.__update(e.clientX,e.clientY,!0)}__onMouseEnter(e){this.mouseover=!0,this.__update(e.clientX,e.clientY,!0)}__onTouchStart(e){this.mouseover=!0,this.mousedown=!0;const t=e.changedTouches[0];this.__update(t.clientX,t.clientY,!0)}__onMouseMove(e){(this.mousedown||this.mouseover)&&(e.stopPropagation(),this.__update(e.clientX,e.clientY,!0))}__onTouchMove(e){if(this.mousedown||this.mouseover){e.stopPropagation();const t=e.changedTouches[0];this.__update(t.clientX,t.clientY,!0)}}__onMouseUp(e){this.mousedown&&(this.mousedown=!1,this.__update(e.clientX,e.clientY,!1))}__onMouseLeave(e){this.mouseover&&(this.mouseover=!1,this.__update(e.clientX,e.clientY,!0))}__onTouchEnd(e){if(this.mousedown){this.mouseover=!1,this.mousedown=!1;const t=e.changedTouches[0];this.__update(t.clientX,t.clientY,!1)}}__update(e,t,i){const s=this.container.getBoundingClientRect(),r=this.isVertical?t:e,o=s[this.isVertical?"bottom":"left"],n=s[this.isVertical?"height":"width"],a=Math.abs((o-r)/n);this.listener({value:a,click:!i,mousedown:this.mousedown,mouseover:this.mouseover,cursor:{clientX:e,clientY:t}})}},Xs={};We(Xs,{BeforeAnimateEvent:()=>De,BeforeRenderEvent:()=>Ft,BeforeRotateEvent:()=>jt,ClickEvent:()=>$t,ConfigChangedEvent:()=>O,DoubleClickEvent:()=>qt,FullscreenEvent:()=>Q,HideNotificationEvent:()=>J,HideOverlayEvent:()=>ri,HidePanelEvent:()=>F,HideTooltipEvent:()=>ci,KeypressEvent:()=>W,LoadProgressEvent:()=>vi,ObjectEnterEvent:()=>$i,ObjectEvent:()=>Me,ObjectHoverEvent:()=>qi,ObjectLeaveEvent:()=>Ne,PanoramaErrorEvent:()=>yi,PanoramaLoadedEvent:()=>ze,PositionUpdatedEvent:()=>ee,ReadyEvent:()=>te,RenderEvent:()=>Li,ShowNotificationEvent:()=>ie,ShowOverlayEvent:()=>ki,ShowPanelEvent:()=>Y,ShowTooltipEvent:()=>zi,SizeUpdatedEvent:()=>se,StopAllEvent:()=>Wi,ViewerEvent:()=>f,ZoomUpdatedEvent:()=>z});var Bs=class extends Event{constructor(e,t=!1){super(e,{cancelable:t})}},Pt=class extends EventTarget{dispatchEvent(e){return super.dispatchEvent(e)}addEventListener(e,t,i){super.addEventListener(e,t,i)}removeEventListener(e,t,i){super.removeEventListener(e,t,i)}},f=class extends Bs{},zt=class Nt extends f{constructor(t,i){super(Nt.type,!0),this.position=t,this.zoomLevel=i}};zt.type="before-animate";var De=zt,Ut=class Vt extends f{constructor(t,i){super(Vt.type),this.timestamp=t,this.elapsed=i}};Ut.type="before-render";var Ft=Ut,Wt=class Yt extends f{constructor(t){super(Yt.type,!0),this.position=t}};Wt.type="before-rotate";var jt=Wt,Xt=class Bt extends f{constructor(t){super(Bt.type),this.data=t}};Xt.type="click";var $t=Xt,Zt=class Gt extends f{constructor(t){super(Gt.type),this.options=t}containsOptions(...t){return t.some(i=>this.options.includes(i))}};Zt.type="config-changed";var O=Zt,Dt=class Kt extends f{constructor(t){super(Kt.type),this.data=t}};Dt.type="dblclick";var qt=Dt,Qt=class Jt extends f{constructor(t){super(Jt.type),this.fullscreenEnabled=t}};Qt.type="fullscreen";var Q=Qt,ei=class ti extends f{constructor(t){super(ti.type),this.notificationId=t}};ei.type="hide-notification";var J=ei,ii=class si extends f{constructor(t){super(si.type),this.overlayId=t}};ii.type="hide-overlay";var ri=ii,oi=class ni extends f{constructor(t){super(ni.type),this.panelId=t}};oi.type="hide-panel";var F=oi,ai=class hi extends f{constructor(t){super(hi.type),this.tooltipData=t}};ai.type="hide-tooltip";var ci=ai,li=class di extends f{constructor(t){super(di.type,!0),this.key=t}};li.type="key-press";var W=li,ui=class pi extends f{constructor(t){super(pi.type),this.progress=t}};ui.type="load-progress";var vi=ui,fi=class mi extends f{constructor(t){super(mi.type),this.data=t}};fi.type="panorama-loaded";var ze=fi,wi=class gi extends f{constructor(t,i){super(gi.type),this.panorama=t,this.error=i}};wi.type="panorama-error";var yi=wi,Ei=class bi extends f{constructor(t){super(bi.type),this.position=t}};Ei.type="position-updated";var ee=Ei,_i=class Ti extends f{constructor(){super(Ti.type)}};_i.type="ready";var te=_i,Oi=class Mi extends f{constructor(){super(Mi.type)}};Oi.type="render";var Li=Oi,xi=class Ci extends f{constructor(t){super(Ci.type),this.notificationId=t}};xi.type="show-notification";var ie=xi,Si=class Ii extends f{constructor(t){super(Ii.type),this.overlayId=t}};Si.type="show-overlay";var ki=Si,Ri=class Ai extends f{constructor(t){super(Ai.type),this.panelId=t}};Ri.type="show-panel";var Y=Ri,Hi=class Pi extends f{constructor(t,i){super(Pi.type),this.tooltip=t,this.tooltipData=i}};Hi.type="show-tooltip";var zi=Hi,Ni=class Ui extends f{constructor(t){super(Ui.type),this.size=t}};Ni.type="size-updated";var se=Ni,Vi=class Fi extends f{constructor(){super(Fi.type)}};Vi.type="stop-all";var Wi=Vi,Yi=class ji extends f{constructor(t){super(ji.type),this.zoomLevel=t}};Yi.type="zoom-updated";var z=Yi,Me=class extends f{constructor(e,t,i,s,r){super(e),this.originalEvent=t,this.object=i,this.viewerPoint=s,this.userDataKey=r}},Xi=class Bi extends Me{constructor(t,i,s,r){super(Bi.type,t,i,s,r)}};Xi.type="enter-object";var $i=Xi,Zi=class Gi extends Me{constructor(t,i,s,r){super(Gi.type,t,i,s,r)}};Zi.type="leave-object";var Ne=Zi,Di=class Ki extends Me{constructor(t,i,s,r){super(Ki.type,t,i,s,r)}};Di.type="hover-object";var qi=Di,Le=class M{constructor(t){this.viewer=t}init(){}destroy(){}supportsTransition(t){return!1}supportsPreload(t){return!1}static createOverlayMaterial({additionalUniforms:t,overrideVertexShader:i}={}){return new Ls({uniforms:{...t,[M.OVERLAY_UNIFORMS.panorama]:{value:null},[M.OVERLAY_UNIFORMS.overlay]:{value:null},[M.OVERLAY_UNIFORMS.globalOpacity]:{value:1},[M.OVERLAY_UNIFORMS.overlayOpacity]:{value:0}},vertexShader:i||`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );
}`,fragmentShader:`
uniform sampler2D ${M.OVERLAY_UNIFORMS.panorama};
uniform sampler2D ${M.OVERLAY_UNIFORMS.overlay};
uniform float ${M.OVERLAY_UNIFORMS.globalOpacity};
uniform float ${M.OVERLAY_UNIFORMS.overlayOpacity};

varying vec2 vUv;

void main() {
  vec4 tColor1 = texture2D( ${M.OVERLAY_UNIFORMS.panorama}, vUv );
  vec4 tColor2 = texture2D( ${M.OVERLAY_UNIFORMS.overlay}, vUv );
  gl_FragColor = vec4(
    mix( tColor1.rgb, tColor2.rgb, tColor2.a * ${M.OVERLAY_UNIFORMS.overlayOpacity} ),
    ${M.OVERLAY_UNIFORMS.globalOpacity}
  );
}`})}};Le.supportsDownload=!1;Le.supportsOverlay=!1;Le.OVERLAY_UNIFORMS={panorama:"panorama",overlay:"overlay",globalOpacity:"globalOpacity",overlayOpacity:"overlayOpacity"};var N=Le;function rt(e){if(e){for(const[,t]of[["_",e],...Object.entries(e)])if(t.prototype instanceof N)return t}return null}var K=`${j}_touchSupport`,_={loaded:!1,pixelRatio:1,isWebGLSupported:!1,maxTextureWidth:0,isTouchEnabled:null,fullscreenEvent:null,__maxCanvasWidth:null,get maxCanvasWidth(){return this.__maxCanvasWidth===null&&(this.__maxCanvasWidth=Gs(this.maxTextureWidth)),this.__maxCanvasWidth},load(){if(!this.loaded){const e=$s();this.pixelRatio=window.devicePixelRatio||1,this.isWebGLSupported=e!==null,this.maxTextureWidth=e?e.getParameter(e.MAX_TEXTURE_SIZE):0,this.isTouchEnabled=Zs(),this.fullscreenEvent=Ds(),this.loaded=!0}if(!_.isWebGLSupported)throw new v("WebGL is not supported.");if(_.maxTextureWidth===0)throw new v("Unable to detect system capabilities")}};function $s(){const e=document.createElement("canvas"),t=["webgl2","webgl","experimental-webgl","moz-webgl","webkit-3d"];let i=null;return e.getContext&&t.some(s=>{try{return i=e.getContext(s),i!==null}catch{return!1}})?i:null}function Zs(){let e="ontouchstart"in window||navigator.maxTouchPoints>0;K in localStorage&&(e=localStorage[K]==="true");const t=new Promise(i=>{const s=()=>{window.removeEventListener("mousedown",r),window.removeEventListener("touchstart",o),clearTimeout(a)},r=()=>{s(),localStorage[K]=!1,i(!1)},o=()=>{s(),localStorage[K]=!0,i(!0)},n=()=>{s(),localStorage[K]=e,i(e)};window.addEventListener("mousedown",r,!1),window.addEventListener("touchstart",o,!1);const a=setTimeout(n,1e4)});return{initial:e,promise:t}}function Gs(e){const t=document.createElement("canvas"),i=t.getContext("2d");for(t.width=e,t.height=e/2;t.width>1024;){i.fillStyle="white",i.fillRect(0,0,1,1);try{if(i.getImageData(0,0,1,1).data[0]>0)return t.width}catch{}t.width/=2,t.height/=2}throw new v("Unable to detect system capabilities")}function Ds(){return"exitFullscreen"in document?"fullscreenchange":"webkitExitFullscreen"in document?"webkitfullscreenchange":null}function Ks(){self.onmessage=o=>{const n=o.data.panoData,a=new OffscreenCanvas(n.fullWidth,n.fullHeight),h=a.getContext("2d"),l=new OffscreenCanvas(n.croppedWidth,n.croppedHeight);l.getContext("2d").putImageData(o.data.image,0,0),e(a,l,n),postMessage(h.getImageData(0,0,a.width,a.height))};function e(o,n,a){const h=a.fullHeight-a.croppedHeight-a.croppedY,l=a.fullWidth-a.croppedWidth-a.croppedX,p=a.croppedY+a.croppedHeight/2,y=o.width/32,d=y,c=10,m=`blur(${y}px)`,u=o.getContext("2d");if(u.drawImage(n,a.croppedX,a.croppedY,a.croppedWidth,a.croppedHeight),a.croppedY>0){if(a.croppedX>0||l>0){u.filter="none";const A=r(u,a.croppedX,a.croppedY,c,c,2),H=r(u,o.width-l-11,a.croppedY,c,c,2),P=i(A,H);a.croppedX>0&&(u.fillStyle=s(u,0,a.croppedX,P,A),u.fillRect(-d,-d,a.croppedX+d*2,p+d)),l>0&&(u.fillStyle=s(u,o.width-l,o.width,H,P),u.fillRect(o.width-l-d,-d,l+d*2,p+d))}u.filter=m,u.drawImage(n,0,0,n.width,c,a.croppedX,-d,a.croppedWidth,a.croppedY+d*2),u.fillStyle=t(r(u,0,0,o.width,c,c)),u.fillRect(-d,-d,o.width+d*2,d*2)}if(h>0){if(a.croppedX>0||l>0){u.filter="none";const A=r(u,a.croppedX,o.height-h-1-c,c,c,2),H=r(u,o.width-l-1-c,o.height-h-1-c,c,c,2),P=i(A,H);a.croppedX>0&&(u.fillStyle=s(u,0,a.croppedX,P,A),u.fillRect(-d,p,a.croppedX+d*2,o.height-p+d)),l>0&&(u.fillStyle=s(u,o.width-l,o.width,H,P),u.fillRect(o.width-l-d,p,l+d*2,o.height-p+d))}u.filter=m,u.drawImage(n,0,n.height-c,n.width,c,a.croppedX,o.height-h-d,a.croppedWidth,h+d*2),u.fillStyle=t(r(u,0,o.height-1-c,o.width,c,c)),u.fillRect(-d,o.height-d,o.width+d*2,d*2)}a.croppedX>0&&(u.filter=m,u.drawImage(n,n.width-c,0,c,n.height,-d,a.croppedY,d*2,a.croppedHeight),u.drawImage(n,0,0,c,n.height,0,a.croppedY,a.croppedX+d,a.croppedHeight)),l>0&&(u.filter=m,u.drawImage(n,0,0,c,n.height,o.width-d,a.croppedY,d*2,a.croppedHeight),u.drawImage(n,n.width-c,0,c,n.height,o.width-l-d,a.croppedY,l+d,a.croppedHeight)),u.filter="none",u.drawImage(n,a.croppedX,a.croppedY,a.croppedWidth,a.croppedHeight)}function t(o){return`rgb(${o.r}, ${o.g}, ${o.b})`}function i(o,n){return{r:Math.round(o.r/2+n.r/2),g:Math.round(o.g/2+n.g/2),b:Math.round(o.b/2+n.b/2)}}function s(o,n,a,h,l){const p=o.createLinearGradient(n,0,a,0);return p.addColorStop(0,t(h)),p.addColorStop(1,t(l)),p}function r(o,n,a,h,l,p){p=Math.round(p);let y=0,d=0,c=0,m=0;const u=o.getImageData(n,a,h,l);for(let A=0;A<l;A+=p)for(let H=0;H<h;H+=p){const P=4*(A*h+H);y+=u.data[P],d+=u.data[P+1],c+=u.data[P+2],m++}return y=Math.round(y/m),d=Math.round(d/m),c=Math.round(c/m),{r:y,g:d,b:c}}}var qs=URL.createObjectURL(new Blob(["(",Ks.toString(),")()"],{type:"application/javascript"})),Qs=Te({backgroundColor:"#000",interpolateBackground:!1,resolution:64,useXmpData:!0,blur:!1},{resolution:e=>{if(!e||!E.isPowerOfTwo(e))throw new v("EquirectangularAdapter resolution must be power of two");return e}}),xe=class extends N{constructor(e,t){super(e),this.config=Qs(t),S(this.viewer.config.useXmpData)||(this.config.useXmpData=this.viewer.config.useXmpData),S(this.viewer.config.canvasBackground)||(this.config.backgroundColor=this.viewer.config.canvasBackground),this.config.interpolateBackground&&(window.Worker?this.interpolationWorker=new Worker(qs):(g("Web Worker API not available"),this.config.interpolateBackground=!1)),this.SPHERE_SEGMENTS=this.config.resolution,this.SPHERE_HORIZONTAL_SEGMENTS=this.SPHERE_SEGMENTS/2}supportsTransition(){return!0}supportsPreload(){return!0}destroy(){var e;(e=this.interpolationWorker)==null||e.terminate(),super.destroy()}async loadTexture(e,t,i=this.config.useXmpData){if(typeof e!="string")return Promise.reject(new v("Invalid panorama url, are you using the right adapter?"));const s=await this.viewer.textureLoader.loadFile(e,h=>this.viewer.loader.setProgress(h),e),r=i?await this.loadXMP(s):null,o=await this.viewer.textureLoader.blobToImage(s);typeof t=="function"&&(t=t(o,r)),!t&&!r&&(t=this.__defaultPanoData(o));const n={fullWidth:k(t==null?void 0:t.fullWidth,r==null?void 0:r.fullWidth,o.width),fullHeight:k(t==null?void 0:t.fullHeight,r==null?void 0:r.fullHeight,o.height),croppedWidth:k(t==null?void 0:t.croppedWidth,r==null?void 0:r.croppedWidth,o.width),croppedHeight:k(t==null?void 0:t.croppedHeight,r==null?void 0:r.croppedHeight,o.height),croppedX:k(t==null?void 0:t.croppedX,r==null?void 0:r.croppedX,0),croppedY:k(t==null?void 0:t.croppedY,r==null?void 0:r.croppedY,0),poseHeading:k(t==null?void 0:t.poseHeading,r==null?void 0:r.poseHeading,0),posePitch:k(t==null?void 0:t.posePitch,r==null?void 0:r.posePitch,0),poseRoll:k(t==null?void 0:t.poseRoll,r==null?void 0:r.poseRoll,0)};(n.croppedWidth!==o.width||n.croppedHeight!==o.height)&&g(`Invalid panoData, croppedWidth/croppedHeight is not coherent with the loaded image.
            panoData: ${n.croppedWidth}x${n.croppedHeight}, image: ${o.width}x${o.height}`),Math.abs(n.fullWidth-n.fullHeight*2)>1&&(g("Invalid panoData, fullWidth should be twice fullHeight"),n.fullWidth=n.fullHeight*2),n.croppedX+n.croppedWidth>n.fullWidth&&(g("Invalid panoData, croppedX + croppedWidth > fullWidth"),n.croppedX=n.fullWidth-n.croppedWidth),n.croppedY+n.croppedHeight>n.fullHeight&&(g("Invalid panoData, croppedY + croppedHeight > fullHeight"),n.croppedY=n.fullHeight-n.croppedHeight);const a=this.createEquirectangularTexture(o,n);return{panorama:e,texture:a,panoData:n,cacheKey:e}}async loadXMP(e){const t=await this.loadBlobAsString(e),i=t.indexOf("<x:xmpmeta"),s=t.indexOf("</x:xmpmeta>"),r=t.substring(i,s);return i!==-1&&s!==-1&&r.includes("GPano:")?{fullWidth:R(r,"FullPanoWidthPixels"),fullHeight:R(r,"FullPanoHeightPixels"),croppedWidth:R(r,"CroppedAreaImageWidthPixels"),croppedHeight:R(r,"CroppedAreaImageHeightPixels"),croppedX:R(r,"CroppedAreaLeftPixels"),croppedY:R(r,"CroppedAreaTopPixels"),poseHeading:R(r,"PoseHeadingDegrees"),posePitch:R(r,"PosePitchDegrees"),poseRoll:R(r,"PoseRollDegrees")}:null}loadBlobAsString(e){return new Promise((t,i)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=i,s.readAsText(e)})}createEquirectangularTexture(e,t){if(this.config.blur||t.fullWidth>_.maxTextureWidth||t.croppedWidth!==t.fullWidth||t.croppedHeight!==t.fullHeight){const i=Math.min(1,_.maxCanvasWidth/t.fullWidth),s={fullWidth:t.fullWidth*i,fullHeight:t.fullHeight*i,croppedWidth:t.croppedWidth*i,croppedHeight:t.croppedHeight*i,croppedX:t.croppedX*i,croppedY:t.croppedY*i},r=document.createElement("canvas");r.width=s.fullWidth,r.height=s.fullHeight;const o=r.getContext("2d");this.config.backgroundColor&&(o.fillStyle=this.config.backgroundColor,o.fillRect(0,0,r.width,r.height)),this.config.blur&&(o.filter=`blur(${r.width/2048}px)`),o.drawImage(e,s.croppedX,s.croppedY,s.croppedWidth,s.croppedHeight);const n=He(r);return this.config.interpolateBackground&&(t.croppedWidth!==t.fullWidth||t.croppedHeight!==t.fullHeight)&&(this.interpolationWorker.postMessage({image:o.getImageData(s.croppedX,s.croppedY,s.croppedWidth,s.croppedHeight),panoData:s}),this.interpolationWorker.onmessage=a=>{o.putImageData(a.data,0,0),n.needsUpdate=!0,this.viewer.needsUpdate()}),n}return He(e)}createMesh(e=1){const t=new fs(ae*e,this.SPHERE_SEGMENTS,this.SPHERE_HORIZONTAL_SEGMENTS,-Math.PI/2).scale(-1,1,1),i=N.createOverlayMaterial();return new ms(t,i)}setTexture(e,t){this.__setUniform(e,N.OVERLAY_UNIFORMS.panorama,t.texture)}setOverlay(e,t,i){this.__setUniform(e,N.OVERLAY_UNIFORMS.overlayOpacity,i),t?this.__setUniform(e,N.OVERLAY_UNIFORMS.overlay,t.texture):this.__setUniform(e,N.OVERLAY_UNIFORMS.overlay,null)}setTextureOpacity(e,t){this.__setUniform(e,N.OVERLAY_UNIFORMS.globalOpacity,t),e.material.transparent=t<1}disposeTexture(e){var t;(t=e.texture)==null||t.dispose()}__setUniform(e,t,i){e.material.uniforms[t].value=i}__defaultPanoData(e){const t=Math.max(e.width,e.height*2),i=Math.round(t/2),s=Math.round((t-e.width)/2),r=Math.round((i-e.height)/2);return{fullWidth:t,fullHeight:i,croppedWidth:e.width,croppedHeight:e.height,croppedX:s,croppedY:r}}};xe.id="equirectangular";xe.supportsDownload=!0;xe.supportsOverlay=!0;var B=class Qi{constructor(t,i){this.parent=t,this.children=[],this.container=document.createElement("div"),this.state={visible:!0},this.viewer=t instanceof Qi?t.viewer:t,this.container.className=i.className||"",this.parent.children.push(this),this.parent.container.appendChild(this.container)}destroy(){this.parent.container.removeChild(this.container);const t=this.parent.children.indexOf(this);t!==-1&&this.parent.children.splice(t,1),this.children.slice().forEach(i=>i.destroy()),this.children.length=0}toggle(t=!this.isVisible()){t?this.show():this.hide()}hide(t){this.container.style.display="none",this.state.visible=!1}show(t){this.container.style.display="",this.state.visible=!0}isVisible(){return this.state.visible}},Js=Te({id:null,className:null,title:null,hoverScale:!1,collapsable:!1,tabbable:!0,icon:null,iconActive:null}),L=class extends B{constructor(e,t){super(e,{className:`psv-button ${t.hoverScale?"psv-button--hover-scale":""} ${t.className||""}`}),this.state={visible:!0,enabled:!0,supported:!0,collapsed:!1,active:!1,width:0},this.config=Js(t),this.config.id=this.constructor.id,t.icon&&this.__setIcon(t.icon),this.state.width=this.container.offsetWidth,this.config.title?this.container.title=this.config.title:this.id&&this.id in this.viewer.config.lang&&(this.container.title=this.viewer.config.lang[this.id]),t.tabbable&&(this.container.tabIndex=0),this.container.addEventListener("click",i=>{this.state.enabled&&this.onClick(),i.stopPropagation()}),this.container.addEventListener("keydown",i=>{i.key===b.Enter&&this.state.enabled&&(this.onClick(),i.stopPropagation())})}get id(){return this.config.id}get title(){return this.container.title}get content(){return this.container.innerHTML}get width(){return this.state.width}get collapsable(){return this.config.collapsable}show(e=!0){this.isVisible()||(this.state.visible=!0,this.state.collapsed||(this.container.style.display=""),e&&this.viewer.navbar.autoSize())}hide(e=!0){this.isVisible()&&(this.state.visible=!1,this.container.style.display="none",e&&this.viewer.navbar.autoSize())}checkSupported(){Ze(this.isSupported(),(e,t)=>{this.state&&(this.state.supported=e,t?e||this.hide():this.toggle(e))})}autoSize(){}isSupported(){return!0}toggleActive(e=!this.state.active){e!==this.state.active&&(this.state.active=e,be(this.container,"psv-button--active",this.state.active),this.config.iconActive&&this.__setIcon(this.state.active?this.config.iconActive:this.config.icon))}disable(){this.container.classList.add("psv-button--disabled"),this.state.enabled=!1}enable(){this.container.classList.remove("psv-button--disabled"),this.state.enabled=!0}collapse(){this.state.collapsed=!0,this.container.style.display="none"}uncollapse(){this.state.collapsed=!1,this.state.visible&&(this.container.style.display="")}__setIcon(e){this.container.innerHTML=e,je(this.container.querySelector("svg"),"psv-button-svg")}},er=class extends L{constructor(e,t){super(e,{className:`psv-custom-button ${t.className||""}`,hoverScale:!1,collapsable:t.collapsable!==!1,tabbable:t.tabbable!==!1,title:t.title}),this.customOnClick=t.onClick,t.id?this.config.id=t.id:this.config.id="psvButton-"+Math.random().toString(36).substring(2),t.content&&(this.container.innerHTML=t.content),this.state.width=this.container.offsetWidth,t.disabled&&this.disable(),t.visible===!1&&this.hide()}onClick(){var e;(e=this.customOnClick)==null||e.call(this,this.viewer)}},ne=class extends L{constructor(e){super(e,{className:"psv-description-button",hoverScale:!0,collapsable:!1,tabbable:!0,icon:I.info}),this.mode=0,this.viewer.addEventListener(J.type,this),this.viewer.addEventListener(ie.type,this),this.viewer.addEventListener(F.type,this),this.viewer.addEventListener(Y.type,this),this.viewer.addEventListener(O.type,this)}destroy(){this.viewer.removeEventListener(J.type,this),this.viewer.removeEventListener(ie.type,this),this.viewer.removeEventListener(F.type,this),this.viewer.removeEventListener(Y.type,this),this.viewer.removeEventListener(O.type,this),super.destroy()}handleEvent(e){if(e instanceof O){e.containsOptions("description")&&this.autoSize(!0);return}if(!this.mode)return;let t=!1;e instanceof J?t=this.mode===1:e instanceof ie?t=this.mode===1&&e.notificationId!==T.DESCRIPTION:e instanceof F?t=this.mode===2:e instanceof Y&&(t=this.mode===2&&e.panelId!==T.DESCRIPTION),t&&(this.toggleActive(!1),this.mode=0)}onClick(){this.mode?this.__close():this.__open()}hide(e){super.hide(e),this.mode&&this.__close()}autoSize(e=!1){if(e){const t=this.viewer.navbar.getButton("caption",!1),i=t&&!t.isVisible(),s=!!this.viewer.config.description;i||s?this.show(!1):this.hide(!1)}}__close(){switch(this.mode){case 1:this.viewer.notification.hide(T.DESCRIPTION);break;case 2:this.viewer.panel.hide(T.DESCRIPTION);break}}__open(){this.toggleActive(!0),this.viewer.config.description?(this.mode=2,this.viewer.panel.show({id:T.DESCRIPTION,content:(this.viewer.config.caption?`<p>${this.viewer.config.caption}</p>`:"")+this.viewer.config.description})):(this.mode=1,this.viewer.notification.show({id:T.DESCRIPTION,content:this.viewer.config.caption}))}};ne.id="description";var Ji=class extends L{constructor(e){super(e,{className:"psv-download-button",hoverScale:!0,collapsable:!0,tabbable:!0,icon:I.download}),this.viewer.addEventListener(O.type,this)}destroy(){this.viewer.removeEventListener(O.type,this),super.destroy()}handleEvent(e){e instanceof O&&e.containsOptions("downloadUrl")&&this.checkSupported()}onClick(){const e=document.createElement("a");e.href=this.viewer.config.downloadUrl||this.viewer.config.panorama,e.href.startsWith("data:")&&!this.viewer.config.downloadName?e.download="panorama."+e.href.substring(0,e.href.indexOf(";")).split("/").pop():e.download=this.viewer.config.downloadName||e.href.split("/").pop(),e.target="_blank",this.viewer.container.appendChild(e),e.click(),setTimeout(()=>{this.viewer.container.removeChild(e)},100)}checkSupported(){this.viewer.adapter.constructor.supportsDownload||this.viewer.config.downloadUrl?this.show():this.hide()}};Ji.id="download";var es=class extends L{constructor(e){super(e,{className:"psv-fullscreen-button",hoverScale:!0,collapsable:!1,tabbable:!0,icon:I.fullscreenIn,iconActive:I.fullscreenOut}),this.viewer.addEventListener(Q.type,this)}destroy(){this.viewer.removeEventListener(Q.type,this),super.destroy()}handleEvent(e){e instanceof Q&&this.toggleActive(e.fullscreenEnabled)}onClick(){this.viewer.toggleFullscreen()}};es.id="fullscreen";var tr="psvButton",ir=(e,t)=>`
<div class="psv-panel-menu psv-panel-menu--stripped">
  <h1 class="psv-panel-menu-title">${I.menu} ${t}</h1>
  <ul class="psv-panel-menu-list">
    ${e.map(i=>`
    <li data-psv-button="${i.id}" class="psv-panel-menu-item" tabindex="0">
      <span class="psv-panel-menu-item-icon">${i.content}</span>
      <span class="psv-panel-menu-item-label">${i.title}</span>
    </li>
    `).join("")}
  </ul>
</div>
`,me=class extends L{constructor(e){super(e,{className:"psv-menu-button",hoverScale:!0,collapsable:!1,tabbable:!0,icon:I.menu}),this.viewer.addEventListener(Y.type,this),this.viewer.addEventListener(F.type,this),super.hide()}destroy(){this.viewer.removeEventListener(Y.type,this),this.viewer.removeEventListener(F.type,this),super.destroy()}handleEvent(e){e instanceof Y?this.toggleActive(e.panelId===T.MENU):e instanceof F&&this.toggleActive(!1)}onClick(){this.state.active?this.__hideMenu():this.__showMenu()}hide(e){super.hide(e),this.__hideMenu()}show(e){super.show(e),this.state.active&&this.__showMenu()}__showMenu(){this.viewer.panel.show({id:T.MENU,content:ir(this.viewer.navbar.collapsed,this.viewer.config.lang.menu),noMargin:!0,clickHandler:e=>{const t=e?Xe(e,"li"):void 0,i=t?t.dataset[tr]:void 0;i&&(this.viewer.navbar.getButton(i).onClick(),this.__hideMenu())}})}__hideMenu(){this.viewer.panel.hide(T.MENU)}};me.id="menu";function sr(e){let t=0;switch(e){case 0:t=90;break;case 1:t=-90;break;case 3:t=180;break;default:t=0;break}return I.arrow.replace("rotate(0",`rotate(${t}`)}var ce=class extends L{constructor(e,t){super(e,{className:"psv-move-button",hoverScale:!0,collapsable:!1,tabbable:!0,icon:sr(t)}),this.direction=t,this.handler=new Oe,this.container.addEventListener("mousedown",this),this.container.addEventListener("keydown",this),this.container.addEventListener("keyup",this),this.viewer.container.addEventListener("mouseup",this),this.viewer.container.addEventListener("touchend",this)}destroy(){this.__onMouseUp(),this.viewer.container.removeEventListener("mouseup",this),this.viewer.container.removeEventListener("touchend",this),super.destroy()}handleEvent(e){switch(e.type){case"mousedown":this.__onMouseDown();break;case"mouseup":this.__onMouseUp();break;case"touchend":this.__onMouseUp();break;case"keydown":e.key===b.Enter&&this.__onMouseDown();break;case"keyup":e.key===b.Enter&&this.__onMouseUp();break}}onClick(){}isSupported(){return _e(_.isTouchEnabled)}__onMouseDown(){if(!this.state.enabled)return;const e={};switch(this.direction){case 0:e.pitch=!1;break;case 1:e.pitch=!0;break;case 3:e.yaw=!1;break;default:e.yaw=!0;break}this.viewer.stopAll(),this.viewer.dynamics.position.roll(e),this.handler.down()}__onMouseUp(){this.state.enabled&&this.handler.up(()=>{this.viewer.dynamics.position.stop(),this.viewer.resetIdleTimer()})}};ce.groupId="move";var ts=class extends ce{constructor(e){super(e,1)}};ts.id="moveDown";var is=class extends ce{constructor(e){super(e,2)}};is.id="moveLeft";var ss=class extends ce{constructor(e){super(e,3)}};ss.id="moveRight";var rs=class extends ce{constructor(e){super(e,0)}};rs.id="moveUp";var Ke=class extends L{constructor(e,t,i){super(e,{className:"psv-zoom-button",hoverScale:!0,collapsable:!1,tabbable:!0,icon:t}),this.direction=i,this.handler=new Oe,this.container.addEventListener("mousedown",this),this.container.addEventListener("keydown",this),this.container.addEventListener("keyup",this),this.viewer.container.addEventListener("mouseup",this),this.viewer.container.addEventListener("touchend",this)}destroy(){this.__onMouseUp(),this.viewer.container.removeEventListener("mouseup",this),this.viewer.container.removeEventListener("touchend",this),super.destroy()}handleEvent(e){switch(e.type){case"mousedown":this.__onMouseDown();break;case"mouseup":this.__onMouseUp();break;case"touchend":this.__onMouseUp();break;case"keydown":e.key===b.Enter&&this.__onMouseDown();break;case"keyup":e.key===b.Enter&&this.__onMouseUp();break}}onClick(){}isSupported(){return _e(_.isTouchEnabled)}__onMouseDown(){this.state.enabled&&(this.viewer.dynamics.zoom.roll(this.direction===1),this.handler.down())}__onMouseUp(){this.state.enabled&&this.handler.up(()=>this.viewer.dynamics.zoom.stop())}};Ke.groupId="zoom";var os=class extends Ke{constructor(e){super(e,I.zoomIn,0)}};os.id="zoomIn";var ns=class extends Ke{constructor(e){super(e,I.zoomOut,1)}};ns.id="zoomOut";var qe=class extends L{constructor(e){super(e,{className:"psv-zoom-range",hoverScale:!1,collapsable:!1,tabbable:!1}),this.zoomRange=document.createElement("div"),this.zoomRange.className="psv-zoom-range-line",this.container.appendChild(this.zoomRange),this.zoomValue=document.createElement("div"),this.zoomValue.className="psv-zoom-range-handle",this.zoomRange.appendChild(this.zoomValue),this.slider=new Ht(this.container,"HORIZONTAL",t=>this.__onSliderUpdate(t)),this.mediaMinWidth=parseInt(V(this.container,"maxWidth"),10),this.viewer.addEventListener(z.type,this),this.viewer.state.ready?this.__moveZoomValue(this.viewer.getZoomLevel()):this.viewer.addEventListener(te.type,this)}destroy(){this.slider.destroy(),this.viewer.removeEventListener(z.type,this),this.viewer.removeEventListener(te.type,this),super.destroy()}handleEvent(e){e instanceof z?this.__moveZoomValue(e.zoomLevel):e instanceof te&&this.__moveZoomValue(this.viewer.getZoomLevel())}onClick(){}isSupported(){return _e(_.isTouchEnabled)}autoSize(){this.state.supported&&(this.viewer.state.size.width<=this.mediaMinWidth&&this.state.visible?this.hide(!1):this.viewer.state.size.width>this.mediaMinWidth&&!this.state.visible&&this.show(!1))}__moveZoomValue(e){this.zoomValue.style.left=e/100*this.zoomRange.offsetWidth-this.zoomValue.offsetWidth/2+"px"}__onSliderUpdate(e){e.mousedown&&this.viewer.zoom(e.value*100)}};qe.id="zoomRange";qe.groupId="zoom";var as=class extends Pt{constructor(e){super(),this.viewer=e}init(){}destroy(){}},rr=class extends as{constructor(e,t){super(e),this.config=this.constructor.configParser(t)}setOption(e,t){this.setOptions({[e]:t})}setOptions(e){const t={...this.config,...e},i=this.constructor,s=i.configParser,r=i.readonlyOptions,o=i.id;for(let[n,a]of Object.entries(e)){if(!(n in s.defaults)){g(`${o}: Unknown option "${n}"`);continue}if(r.includes(n)){g(`${o}: Option "${n}" cannot be updated`);continue}n in s.parsers&&(a=s.parsers[n](a,{rawConfig:t,defValue:s.defaults[n]})),this.config[n]=a}}};rr.readonlyOptions=[];function Ue(e){if(e){for(const[,t]of[["_",e],...Object.entries(e)])if(t.prototype instanceof as)return t}return null}var D={panorama:null,overlay:null,overlayOpacity:1,container:null,adapter:[xe,null],plugins:[],caption:null,description:null,downloadUrl:null,downloadName:null,loadingImg:null,loadingTxt:"Loading...",size:null,fisheye:0,minFov:30,maxFov:90,defaultZoomLvl:50,defaultYaw:0,defaultPitch:0,sphereCorrection:null,moveSpeed:1,zoomSpeed:1,moveInertia:!0,mousewheel:!0,mousemove:!0,mousewheelCtrlKey:!1,touchmoveTwoFingers:!1,useXmpData:null,panoData:null,requestHeaders:null,canvasBackground:null,rendererParameters:{alpha:!0,antialias:!0},withCredentials:!1,navbar:["zoom","move","download","description","caption","fullscreen"],lang:{zoom:"Zoom",zoomOut:"Zoom out",zoomIn:"Zoom in",moveUp:"Move up",moveDown:"Move down",moveLeft:"Move left",moveRight:"Move right",download:"Download",fullscreen:"Fullscreen",menu:"Menu",close:"Close",twoFingers:"Use two fingers to navigate",ctrlZoom:"Use ctrl + scroll to zoom the image",loadError:"The panorama can't be loaded"},keyboard:"fullscreen",keyboardActions:{[b.ArrowUp]:"ROTATE_UP",[b.ArrowDown]:"ROTATE_DOWN",[b.ArrowRight]:"ROTATE_RIGHT",[b.ArrowLeft]:"ROTATE_LEFT",[b.PageUp]:"ZOOM_IN",[b.PageDown]:"ZOOM_OUT",[b.Plus]:"ZOOM_IN",[b.Minus]:"ZOOM_OUT"}},ot={panorama:"Use setPanorama method to change the panorama",panoData:"Use setPanorama method to change the panorama",overlay:"Use setOverlay method to changer the overlay",overlayOpacity:"Use setOverlay method to changer the overlay",container:"Cannot change viewer container",adapter:"Cannot change adapter",plugins:"Cannot change plugins"},Ve={container:e=>{if(!e)throw new v("No value given for container.");return e},adapter:(e,{defValue:t})=>{if(e?Array.isArray(e)?e=[rt(e[0]),e[1]]:e=[rt(e),null]:e=t,!e[0])throw new v("An undefined value was given for adapter.");if(!e[0].id)throw new v("Adapter has no id.");return e},overlayOpacity:e=>E.clamp(e,0,1),defaultYaw:e=>U(e),defaultPitch:e=>U(e,!0),defaultZoomLvl:e=>E.clamp(e,0,100),minFov:(e,{rawConfig:t})=>(t.maxFov<e&&(g("maxFov cannot be lower than minFov"),e=t.maxFov),E.clamp(e,1,179)),maxFov:(e,{rawConfig:t})=>(e<t.minFov&&(e=t.minFov),E.clamp(e,1,179)),lang:e=>(Array.isArray(e.twoFingers)&&(g("lang.twoFingers must not be an array"),e.twoFingers=e.twoFingers[0]),{...D.lang,...e}),keyboard:e=>e?typeof e=="object"?(g("Use keyboardActions to configure the keyboard actions, keyboard option must be either true, false, 'fullscreen' or 'always'"),"fullscreen"):e==="always"?"always":"fullscreen":!1,keyboardActions:(e,{rawConfig:t})=>t.keyboard&&typeof t.keyboard=="object"?t.keyboard:e,fisheye:e=>e===!0?1:e===!1?0:e,requestHeaders:e=>e&&typeof e=="object"?()=>e:typeof e=="function"?e:null,rendererParameters:(e,{defValue:t})=>({...e,...t}),plugins:e=>e.map((t,i)=>{if(Array.isArray(t)?t=[Ue(t[0]),t[1]]:t=[Ue(t),null],!t[0])throw new v(`An undefined value was given for plugin ${i}.`);if(!t[0].id)throw new v(`Plugin ${i} has no id.`);return t}),navbar:e=>e===!1?null:e===!0?re(D.navbar):typeof e=="string"?e.split(/[ ,]/):e,useXmpData:e=>(e!==null&&g("Global useXmpData is deprecated, it is now configured on the adapter."),e),canvasBackground:e=>(e!==null&&g("Global canvasBackground is deprecated, it is now configured on the adapter."),e)},or=Te(D,Ve),G=class extends L{constructor(e){super(e,{className:"psv-caption",hoverScale:!1,collapsable:!1,tabbable:!0}),this.contentWidth=0,this.state.width=0,this.contentElt=document.createElement("div"),this.contentElt.className="psv-caption-content",this.container.appendChild(this.contentElt),this.setCaption(this.viewer.config.caption)}hide(){this.contentElt.style.display="none",this.state.visible=!1}show(){this.contentElt.style.display="",this.state.visible=!0}onClick(){}setCaption(e){this.show(),this.contentElt.innerHTML=e??"",this.contentElt.innerHTML?this.contentWidth=this.contentElt.offsetWidth:this.contentWidth=0,this.autoSize()}autoSize(){this.toggle(this.container.offsetWidth>=this.contentWidth),this.__refreshButton()}__refreshButton(){var e;(e=this.viewer.navbar.getButton(ne.id,!1))==null||e.autoSize(!0)}};G.id="caption";var Fe={},Ee={};function nr(e,t){if(!e.id)throw new v("Button id is required");if(Fe[e.id]=e,e.groupId&&(Ee[e.groupId]=Ee[e.groupId]||[]).push(e),t){const i=D.navbar;switch(t){case"start":i.unshift(e.id);break;case"end":i.push(e.id);break;default:{const[s,r]=t.split(":"),o=i.indexOf(s);if(!s||!r||o===-1)throw new v(`Invalid defaultPosition ${t}`);i.splice(o+(r==="right"?1:0),0,e.id)}}}}[ns,qe,os,ne,G,Ji,es,is,ss,rs,ts].forEach(e=>nr(e));var ar=class extends B{constructor(e){super(e,{className:`psv-navbar ${he}`}),this.collapsed=[],this.state.visible=!1}show(){this.container.classList.add("psv-navbar--open"),this.state.visible=!0}hide(){this.container.classList.remove("psv-navbar--open"),this.state.visible=!1}setButtons(e){this.children.slice().forEach(t=>t.destroy()),this.children.length=0,e.indexOf(G.id)!==-1&&e.indexOf(ne.id)===-1&&e.splice(e.indexOf(G.id),0,ne.id),e.forEach(t=>{typeof t=="object"?new er(this,t):Fe[t]?new Fe[t](this):Ee[t]?Ee[t].forEach(i=>{new i(this)}):g(`Unknown button ${t}`)}),new me(this),this.children.forEach(t=>{t instanceof L&&t.checkSupported()}),this.autoSize()}setCaption(e){this.children.some(t=>t instanceof G?(t.setCaption(e),!0):!1)}getButton(e,t=!0){const i=this.children.find(s=>s instanceof L&&s.id===e);return!i&&t&&g(`button "${e}" not found in the navbar`),i}autoSize(){var s;this.children.forEach(r=>{r instanceof L&&r.autoSize()});const e=this.container.offsetWidth;let t=0;const i=[];this.children.forEach(r=>{r.isVisible()&&r instanceof L&&(t+=r.width,r.collapsable&&i.push(r))}),t!==0&&(e<t&&i.length>0?(i.forEach(r=>r.collapse()),this.collapsed=i,this.getButton(me.id).show(!1)):e>=t&&this.collapsed.length>0&&(this.collapsed.forEach(r=>r.uncollapse()),this.collapsed=[],this.getButton(me.id).hide(!1)),(s=this.getButton(G.id,!1))==null||s.autoSize())}},hr=class extends B{constructor(e){super(e,{className:"psv-loader-container"}),this.loader=document.createElement("div"),this.loader.className="psv-loader",this.container.appendChild(this.loader),this.size=this.loader.offsetWidth,this.canvas=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.canvas.setAttribute("class","psv-loader-canvas"),this.canvas.setAttribute("viewBox",`0 0 ${this.size} ${this.size}`),this.loader.appendChild(this.canvas),this.textColor=V(this.loader,"color"),this.color=V(this.canvas,"color"),this.border=parseInt(V(this.loader,"outlineWidth"),10),this.thickness=parseInt(V(this.canvas,"outlineWidth"),10),this.viewer.addEventListener(O.type,this),this.__updateContent(),this.hide()}destroy(){this.viewer.removeEventListener(O.type,this),super.destroy()}handleEvent(e){e instanceof O&&e.containsOptions("loadingImg","loadingTxt")&&this.__updateContent()}setProgress(e){const t=Math.min(e,99.999)/100*Math.PI*2,i=this.size/2,s=i,r=this.thickness/2+this.border,o=(this.size-this.thickness)/2-this.border,n=Math.sin(t)*o+i,a=-Math.cos(t)*o+i,h=e>50?"1":"0";this.canvas.innerHTML=`
            <circle cx="${i}" cy="${i}" r="${i}" fill="${this.color}"/>
            <path d="M ${s} ${r} A ${o} ${o} 0 ${h} 1 ${n} ${a}" 
                  fill="none" stroke="${this.textColor}" stroke-width="${this.thickness}" stroke-linecap="round"/>
        `,this.viewer.dispatchEvent(new vi(Math.round(e)))}__updateContent(){const e=this.loader.querySelector(".psv-loader-image, .psv-loader-text");e&&this.loader.removeChild(e);let t;if(this.viewer.config.loadingImg?(t=document.createElement("img"),t.className="psv-loader-image",t.src=this.viewer.config.loadingImg):this.viewer.config.loadingTxt&&(t=document.createElement("div"),t.className="psv-loader-text",t.innerHTML=this.viewer.config.loadingTxt),t){const i=Math.round(Math.sqrt(2*Math.pow(this.size/2-this.thickness/2-this.border,2)));t.style.maxWidth=i+"px",t.style.maxHeight=i+"px",this.loader.appendChild(t)}}},cr=class extends B{constructor(e){super(e,{className:"psv-notification"}),this.state={visible:!1,contentId:null,timeout:null},this.content=document.createElement("div"),this.content.className="psv-notification-content",this.container.appendChild(this.content),this.content.addEventListener("click",()=>this.hide())}isVisible(e){return this.state.visible&&(!e||!this.state.contentId||this.state.contentId===e)}toggle(){throw new v("Notification cannot be toggled")}show(e){this.state.timeout&&(clearTimeout(this.state.timeout),this.state.timeout=null),typeof e=="string"&&(e={content:e}),this.state.contentId=e.id||null,this.content.innerHTML=e.content,this.container.classList.add("psv-notification--visible"),this.state.visible=!0,this.viewer.dispatchEvent(new ie(e.id)),e.timeout&&(this.state.timeout=setTimeout(()=>this.hide(this.state.contentId),e.timeout))}hide(e){if(this.isVisible(e)){const t=this.state.contentId;this.container.classList.remove("psv-notification--visible"),this.state.visible=!1,this.state.contentId=null,this.viewer.dispatchEvent(new J(t))}}},lr=class extends B{constructor(e){super(e,{className:`psv-overlay ${he}`}),this.state={visible:!1,contentId:null,dissmisable:!0},this.image=document.createElement("div"),this.image.className="psv-overlay-image",this.container.appendChild(this.image),this.title=document.createElement("div"),this.title.className="psv-overlay-title",this.container.appendChild(this.title),this.text=document.createElement("div"),this.text.className="psv-overlay-text",this.container.appendChild(this.text),this.container.addEventListener("click",this),this.viewer.addEventListener(W.type,this),super.hide()}destroy(){this.viewer.removeEventListener(W.type,this),super.destroy()}handleEvent(e){e.type==="click"?this.isVisible()&&this.state.dissmisable&&(this.hide(),e.stopPropagation()):e instanceof W&&this.isVisible()&&this.state.dissmisable&&e.key===b.Escape&&(this.hide(),e.preventDefault())}isVisible(e){return this.state.visible&&(!e||!this.state.contentId||this.state.contentId===e)}toggle(){throw new v("Overlay cannot be toggled")}show(e){typeof e=="string"&&(e={title:e}),this.state.contentId=e.id||null,this.state.dissmisable=e.dissmisable!==!1,this.image.innerHTML=e.image||"",this.title.innerHTML=e.title||"",this.text.innerHTML=e.text||"",super.show(),this.viewer.dispatchEvent(new ki(e.id))}hide(e){if(this.isVisible(e)){const t=this.state.contentId;super.hide(),this.state.contentId=null,this.viewer.dispatchEvent(new ri(t))}}},dr=200,Ce="psv-panel-content--no-interaction",ur=class extends B{constructor(e){super(e,{className:`psv-panel ${he}`}),this.state={visible:!1,contentId:null,mouseX:0,mouseY:0,mousedown:!1,clickHandler:null,keyHandler:null,width:{}};const t=document.createElement("div");t.className="psv-panel-resizer",this.container.appendChild(t);const i=document.createElement("div");i.className="psv-panel-close-button",i.innerHTML=I.close,i.title=e.config.lang.close,this.container.appendChild(i),this.content=document.createElement("div"),this.content.className="psv-panel-content",this.container.appendChild(this.content),this.container.addEventListener("wheel",s=>s.stopPropagation()),i.addEventListener("click",()=>this.hide()),t.addEventListener("mousedown",this),t.addEventListener("touchstart",this),this.viewer.container.addEventListener("mouseup",this),this.viewer.container.addEventListener("touchend",this),this.viewer.container.addEventListener("mousemove",this),this.viewer.container.addEventListener("touchmove",this),this.viewer.addEventListener(W.type,this)}destroy(){this.viewer.removeEventListener(W.type,this),this.viewer.container.removeEventListener("mousemove",this),this.viewer.container.removeEventListener("touchmove",this),this.viewer.container.removeEventListener("mouseup",this),this.viewer.container.removeEventListener("touchend",this),super.destroy()}handleEvent(e){switch(e.type){case"mousedown":this.__onMouseDown(e);break;case"touchstart":this.__onTouchStart(e);break;case"mousemove":this.__onMouseMove(e);break;case"touchmove":this.__onTouchMove(e);break;case"mouseup":this.__onMouseUp(e);break;case"touchend":this.__onTouchEnd(e);break;case W.type:this.__onKeyPress(e);break}}isVisible(e){return this.state.visible&&(!e||!this.state.contentId||this.state.contentId===e)}toggle(){throw new v("Panel cannot be toggled")}show(e){typeof e=="string"&&(e={content:e});const t=this.isVisible(e.id);this.state.contentId=e.id||null,this.state.visible=!0,this.state.clickHandler&&(this.content.removeEventListener("click",this.state.clickHandler),this.content.removeEventListener("keydown",this.state.keyHandler),this.state.clickHandler=null,this.state.keyHandler=null),e.id&&this.state.width[e.id]?this.container.style.width=this.state.width[e.id]:e.width?this.container.style.width=e.width:this.container.style.width=null,this.content.innerHTML=e.content,this.content.scrollTop=0,this.container.classList.add("psv-panel--open"),be(this.content,"psv-panel-content--no-margin",e.noMargin===!0),e.clickHandler&&(this.state.clickHandler=i=>{e.clickHandler(i.target)},this.state.keyHandler=i=>{i.key===b.Enter&&e.clickHandler(i.target)},this.content.addEventListener("click",this.state.clickHandler),this.content.addEventListener("keydown",this.state.keyHandler),t||setTimeout(()=>{var i;(i=this.content.querySelector("a,button,[tabindex]"))==null||i.focus()},300)),this.viewer.dispatchEvent(new Y(e.id))}hide(e){if(this.isVisible(e)){const t=this.state.contentId;this.state.visible=!1,this.state.contentId=null,this.content.innerHTML=null,this.container.classList.remove("psv-panel--open"),this.state.clickHandler&&(this.content.removeEventListener("click",this.state.clickHandler),this.state.clickHandler=null),this.viewer.dispatchEvent(new F(t))}}__onMouseDown(e){e.stopPropagation(),this.__startResize(e.clientX,e.clientY)}__onTouchStart(e){if(e.stopPropagation(),e.touches.length===1){const t=e.touches[0];this.__startResize(t.clientX,t.clientY)}}__onMouseUp(e){this.state.mousedown&&(e.stopPropagation(),this.state.mousedown=!1,this.content.classList.remove(Ce))}__onTouchEnd(e){this.state.mousedown&&(e.stopPropagation(),e.touches.length===0&&(this.state.mousedown=!1,this.content.classList.remove(Ce)))}__onMouseMove(e){this.state.mousedown&&(e.stopPropagation(),this.__resize(e.clientX,e.clientY))}__onTouchMove(e){if(this.state.mousedown){const t=e.touches[0];this.__resize(t.clientX,t.clientY)}}__onKeyPress(e){this.isVisible()&&e.key===b.Escape&&(this.hide(),e.preventDefault())}__startResize(e,t){this.state.mouseX=e,this.state.mouseY=t,this.state.mousedown=!0,this.content.classList.add(Ce)}__resize(e,t){const i=e,s=t,r=Math.max(dr,this.container.offsetWidth-(i-this.state.mouseX))+"px";this.state.contentId&&(this.state.width[this.state.contentId]=r),this.container.style.width=r,this.state.mouseX=i,this.state.mouseY=s}},pr=class extends B{constructor(e,t){super(e,{className:"psv-tooltip"}),this.state={visible:!0,arrow:0,border:0,state:0,width:0,height:0,pos:"",config:null,data:null},this.content=document.createElement("div"),this.content.className="psv-tooltip-content",this.container.appendChild(this.content),this.arrow=document.createElement("div"),this.arrow.className="psv-tooltip-arrow",this.container.appendChild(this.arrow),this.container.addEventListener("transitionend",this),this.container.addEventListener("touchdown",i=>i.stopPropagation()),this.container.addEventListener("mousedown",i=>i.stopPropagation()),this.container.style.top="-1000px",this.container.style.left="-1000px",this.show(t)}handleEvent(e){e.type==="transitionend"&&this.__onTransitionEnd(e)}destroy(){delete this.state.data,super.destroy()}toggle(){throw new v("Tooltip cannot be toggled")}show(e){if(this.state.state!==0)throw new v("Initialized tooltip cannot be re-initialized");e.className&&je(this.container,e.className),e.style&&Object.assign(this.container.style,e.style),this.state.state=3,this.update(e.content,e),this.state.data=e.data,this.state.state=1,this.viewer.dispatchEvent(new zi(this,this.state.data)),this.__waitImages()}update(e,t){this.content.innerHTML=e;const i=this.container.getBoundingClientRect();this.state.width=i.right-i.left,this.state.height=i.bottom-i.top,this.state.arrow=parseInt(V(this.arrow,"borderTopWidth"),10),this.state.border=parseInt(V(this.container,"borderTopLeftRadius"),10),this.move(t??this.state.config)}move(e){var a;if(this.state.state!==1&&this.state.state!==3)throw new v("Uninitialized tooltip cannot be moved");e.box=e.box??((a=this.state.config)==null?void 0:a.box)??{width:0,height:0},this.state.config=e;const t=this.container,i=this.arrow,s={posClass:St(e.position,{allowCenter:!1,cssOrder:!1})||["top","center"],width:this.state.width,height:this.state.height,top:0,left:0,arrowTop:0,arrowLeft:0};this.__computeTooltipPosition(s,e);let r=null,o=null;if(s.top<0?r="bottom":s.top+s.height>this.viewer.state.size.height&&(r="top"),s.left<0?o="right":s.left+s.width>this.viewer.state.size.width&&(o="left"),o||r){const h=Ge(s.posClass);r&&(s.posClass[h?0:1]=r),o&&(s.posClass[h?1:0]=o),this.__computeTooltipPosition(s,e)}t.style.top=s.top+"px",t.style.left=s.left+"px",i.style.top=s.arrowTop+"px",i.style.left=s.arrowLeft+"px";const n=s.posClass.join("-");n!==this.state.pos&&(t.classList.remove(`psv-tooltip--${this.state.pos}`),this.state.pos=n,t.classList.add(`psv-tooltip--${this.state.pos}`))}hide(){this.container.classList.remove("psv-tooltip--visible"),this.state.state=2,this.viewer.dispatchEvent(new ci(this.state.data))}__onTransitionEnd(e){if(e.propertyName==="transform")switch(this.state.state){case 1:this.container.classList.add("psv-tooltip--visible"),this.state.state=3;break;case 2:this.state.state=0,this.destroy();break}}__computeTooltipPosition(e,t){const i=this.state.arrow,s=t.top,r=e.height,o=t.left,n=e.width,a=i+this.state.border,h=t.box.width/2+i*2,l=t.box.height/2+i*2;switch(e.posClass.join("-")){case"top-left":e.top=s-l-r,e.left=o+a-n,e.arrowTop=r,e.arrowLeft=n-a-i;break;case"top-center":e.top=s-l-r,e.left=o-n/2,e.arrowTop=r,e.arrowLeft=n/2-i;break;case"top-right":e.top=s-l-r,e.left=o-a,e.arrowTop=r,e.arrowLeft=i;break;case"bottom-left":e.top=s+l,e.left=o+a-n,e.arrowTop=-i*2,e.arrowLeft=n-a-i;break;case"bottom-center":e.top=s+l,e.left=o-n/2,e.arrowTop=-i*2,e.arrowLeft=n/2-i;break;case"bottom-right":e.top=s+l,e.left=o-a,e.arrowTop=-i*2,e.arrowLeft=i;break;case"left-top":e.top=s+a-r,e.left=o-h-n,e.arrowTop=r-a-i,e.arrowLeft=n;break;case"center-left":e.top=s-r/2,e.left=o-h-n,e.arrowTop=r/2-i,e.arrowLeft=n;break;case"left-bottom":e.top=s-a,e.left=o-h-n,e.arrowTop=i,e.arrowLeft=n;break;case"right-top":e.top=s+a-r,e.left=o+h,e.arrowTop=r-a-i,e.arrowLeft=-i*2;break;case"center-right":e.top=s-r/2,e.left=o+h,e.arrowTop=r/2-i,e.arrowLeft=-i*2;break;case"right-bottom":e.top=s-a,e.left=o+h,e.arrowTop=i,e.arrowLeft=-i*2;break}}__waitImages(){const e=this.content.querySelectorAll("img");if(e.length>0){const t=[];e.forEach(i=>{t.push(new Promise(s=>{i.onload=s,i.onerror=s}))}),Promise.all(t).then(()=>{if(this.state.state===1||this.state.state===3){const i=this.container.getBoundingClientRect();this.state.width=i.right-i.left,this.state.height=i.bottom-i.top,this.move(this.state.config)}})}}},Z={enabled:!0,maxItems:10,ttl:10*60,items:{},purgeInterval:null,init(){Se.enabled&&(g("ThreeJS cache should be disabled"),Se.enabled=!1),!this.purgeInterval&&this.enabled&&(this.purgeInterval=setInterval(()=>this.purge(),60*1e3))},add(e,t,i){this.enabled&&t&&(this.items[t]=this.items[t]??{files:{},lastAccess:null},this.items[t].files[e]=i,this.items[t].lastAccess=Date.now())},get(e,t){if(this.enabled&&t&&this.items[t])return this.items[t].lastAccess=Date.now(),this.items[t].files[e]},remove(e,t){this.enabled&&t&&this.items[t]&&(delete this.items[t].files[e],Object.keys(this.items[t].files).length===0&&delete this.items[t])},purge(){Object.entries(this.items).sort(([,e],[,t])=>t.lastAccess-e.lastAccess).forEach(([e,{lastAccess:t}],i)=>{i>0&&(Date.now()-t>=this.ttl*1e3||i>=this.maxItems)&&delete this.items[e]})}},vr=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="15 15 70 70"><path fill="currentColor" d="M50,16.2c-18.6,0-33.8,15.1-33.8,33.8S31.4,83.7,50,83.7S83.8,68.6,83.8,50S68.6,16.2,50,16.2z M50,80.2c-16.7,0-30.2-13.6-30.2-30.2S33.3,19.7,50,19.7S80.3,33.3,80.3,50S66.7,80.2,50,80.2z"/><rect fill="currentColor" x="48" y="31.7" width="4" height="28"/><rect fill="currentColor" x="48" y="63.2" width="4" height="5"/><!--Created by Shastry from the Noun Project--></svg>
`,le=class{constructor(e){this.viewer=e,this.config=e.config,this.state=e.state}destroy(){}},C=new X,ue=new ls(0,0,0,"ZXY"),fr=class extends le{constructor(e){super(e)}fovToZoomLevel(e){const t=Math.round((e-this.config.minFov)/(this.config.maxFov-this.config.minFov)*100);return t-2*(t-50)}zoomLevelToFov(e){return this.config.maxFov+e/100*(this.config.minFov-this.config.maxFov)}vFovToHFov(e){return E.radToDeg(2*Math.atan(Math.tan(E.degToRad(e)/2)*this.state.aspect))}getAnimationProperties(e,t,i){const s=!S(t),r=!S(i),o={};let n;if(s){const a=this.viewer.getPosition(),h=mt(a.yaw,t.yaw);o.yaw={start:a.yaw,end:a.yaw+h},o.pitch={start:a.pitch,end:t.pitch},n=Ae(e,wt(a,t))}if(r){const a=this.viewer.getZoomLevel(),h=Math.abs(i-a);o.zoom={start:a,end:i},n||(n=Ae(e,Math.PI/4*h/100))}return n=Math.max(ht,n),{duration:n,properties:o}}textureCoordsToSphericalCoords(e){const t=this.state.panoData;if(!t)throw new v("Current adapter does not support texture coordinates.");const i=(e.textureX+t.croppedX)/t.fullWidth*Math.PI*2,s=(e.textureY+t.croppedY)/t.fullHeight*Math.PI,r={yaw:i>=Math.PI?i-Math.PI:i+Math.PI,pitch:Math.PI/2-s};return!ue.equals(this.viewer.renderer.panoramaPose)||!ue.equals(this.viewer.renderer.sphereCorrection)?(this.sphericalCoordsToVector3(r,C),C.applyEuler(this.viewer.renderer.panoramaPose),C.applyEuler(this.viewer.renderer.sphereCorrection),this.vector3ToSphericalCoords(C)):r}sphericalCoordsToTextureCoords(e){const t=this.state.panoData;if(!t)throw new v("Current adapter does not support texture coordinates.");(!ue.equals(this.viewer.renderer.panoramaPose)||!ue.equals(this.viewer.renderer.sphereCorrection))&&(this.sphericalCoordsToVector3(e,C),Pe(C,this.viewer.renderer.sphereCorrection),Pe(C,this.viewer.renderer.panoramaPose),e=this.vector3ToSphericalCoords(C));const i=e.yaw/Math.PI/2*t.fullWidth,s=e.pitch/Math.PI*t.fullHeight;return{textureX:Math.round(e.yaw<Math.PI?i+t.fullWidth/2:i-t.fullWidth/2)-t.croppedX,textureY:Math.round(t.fullHeight/2-s)-t.croppedY}}sphericalCoordsToVector3(e,t,i=ae){return t||(t=new X),t.x=i*-Math.cos(e.pitch)*Math.sin(e.yaw),t.y=i*Math.sin(e.pitch),t.z=i*Math.cos(e.pitch)*Math.cos(e.yaw),t}vector3ToSphericalCoords(e){const t=Math.acos(e.y/Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)),i=Math.atan2(e.x,e.z);return{yaw:i<0?-i:Math.PI*2-i,pitch:Math.PI/2-t}}viewerCoordsToVector3(e){const t=this.viewer.renderer.getIntersections(e).filter(i=>i.object.userData[j]);return t.length?t[0].point:null}viewerCoordsToSphericalCoords(e){const t=this.viewerCoordsToVector3(e);return t?this.vector3ToSphericalCoords(t):null}vector3ToViewerCoords(e){const t=e.clone();return t.project(this.viewer.renderer.camera),{x:Math.round((t.x+1)/2*this.state.size.width),y:Math.round((1-t.y)/2*this.state.size.height)}}sphericalCoordsToViewerCoords(e){return this.sphericalCoordsToVector3(e,C),this.vector3ToViewerCoords(C)}isPointVisible(e){let t,i;if(e instanceof X)t=e,i=this.vector3ToViewerCoords(e);else if(we(e))t=this.sphericalCoordsToVector3(e,C),i=this.vector3ToViewerCoords(t);else return!1;return t.dot(this.viewer.state.direction)>0&&i.x>=0&&i.x<=this.viewer.state.size.width&&i.y>=0&&i.y<=this.viewer.state.size.height}cleanPosition(e){return e.textureX!==void 0&&e.textureY!==void 0?this.textureCoordsToSphericalCoords(e):{yaw:U(e.yaw),pitch:U(e.pitch,!this.state.littlePlanet)}}cleanSphereCorrection(e){return{pan:U((e==null?void 0:e.pan)||0),tilt:U((e==null?void 0:e.tilt)||0,!0),roll:U((e==null?void 0:e.roll)||0,!0,!1)}}cleanPanoramaPose(e){return{pan:E.degToRad((e==null?void 0:e.poseHeading)||0),tilt:E.degToRad((e==null?void 0:e.posePitch)||0),roll:E.degToRad((e==null?void 0:e.poseRoll)||0)}}},mr=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="currentColor" d="M33.38 33.2a1.96 1.96 0 0 0 1.5-3.23 10.61 10.61 0 0 1 7.18-17.51c.7-.06 1.31-.49 1.61-1.12a13.02 13.02 0 0 1 11.74-7.43c7.14 0 12.96 5.8 12.96 12.9 0 3.07-1.1 6.05-3.1 8.38-.7.82-.61 2.05.21 2.76.83.7 2.07.6 2.78-.22a16.77 16.77 0 0 0 4.04-10.91C72.3 7.54 64.72 0 55.4 0a16.98 16.98 0 0 0-14.79 8.7 14.6 14.6 0 0 0-12.23 14.36c0 3.46 1.25 6.82 3.5 9.45.4.45.94.69 1.5.69m45.74 43.55a22.13 22.13 0 0 1-5.23 12.4c-4 4.55-9.53 6.86-16.42 6.86-12.6 0-20.1-10.8-20.17-10.91a1.82 1.82 0 0 0-.08-.1c-5.3-6.83-14.55-23.82-17.27-28.87-.05-.1 0-.21.02-.23a6.3 6.3 0 0 1 8.24 1.85l9.38 12.59a1.97 1.97 0 0 0 3.54-1.17V25.34a4 4 0 0 1 1.19-2.87 3.32 3.32 0 0 1 2.4-.95c1.88.05 3.4 1.82 3.4 3.94v24.32a1.96 1.96 0 0 0 3.93 0v-33.1a3.5 3.5 0 0 1 7 0v35.39a1.96 1.96 0 0 0 3.93 0v-.44c.05-2.05 1.6-3.7 3.49-3.7 1.93 0 3.5 1.7 3.5 3.82v5.63c0 .24.04.48.13.71l.1.26a1.97 1.97 0 0 0 3.76-.37c.33-1.78 1.77-3.07 3.43-3.07 1.9 0 3.45 1.67 3.5 3.74l-1.77 18.1zM77.39 51c-1.25 0-2.45.32-3.5.9v-.15c0-4.27-3.33-7.74-7.42-7.74-1.26 0-2.45.33-3.5.9V16.69a7.42 7.42 0 0 0-14.85 0v1.86a7 7 0 0 0-3.28-.94 7.21 7.21 0 0 0-5.26 2.07 7.92 7.92 0 0 0-2.38 5.67v37.9l-5.83-7.82a10.2 10.2 0 0 0-13.35-2.92 4.1 4.1 0 0 0-1.53 5.48C20 64.52 28.74 80.45 34.07 87.34c.72 1.04 9.02 12.59 23.4 12.59 7.96 0 14.66-2.84 19.38-8.2a26.06 26.06 0 0 0 6.18-14.6l1.78-18.2v-.2c0-4.26-3.32-7.73-7.42-7.73z"/><!--Created by AomAm from the Noun Project--></svg>
`,wr=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="10 17 79 79"><path fill="currentColor" d="M38.1 29.27c-.24 0-.44.2-.44.45v10.7a.45.45 0 00.9 0v-10.7c0-.25-.2-.45-.45-.45zm10.2 26.66a11.54 11.54 0 01-8.48-6.14.45.45 0 10-.8.41 12.45 12.45 0 009.22 6.62.45.45 0 00.07-.9zm24.55-13.08a23.04 23.04 0 00-22.56-23v7.07l-.01.05a2.83 2.83 0 012.39 2.78v14.03l.09-.02h8.84v-9.22a.45.45 0 11.9 0v9.22h10.35v-.9zm0 27.33V44.66H62.5c-.02 2.01-.52 4-1.47 5.76a.45.45 0 01-.61.18.45.45 0 01-.19-.61 11.54 11.54 0 001.36-5.33h-8.83l-.1-.01a2.83 2.83 0 01-2.83 2.84h-.04-.04a2.83 2.83 0 01-2.83-2.83v-14.9a2.82 2.82 0 012.47-2.8v-7.11a23.04 23.04 0 00-22.57 23v.91h14.72V29.88a8.2 8.2 0 015.02-7.57c.22-.1.5.01.59.24.1.23-.01.5-.24.6a7.3 7.3 0 00-4.47 6.73v13.88h3.9a.45.45 0 110 .9h-3.9v.15a7.32 7.32 0 0011.23 6.17.45.45 0 01.49.76 8.22 8.22 0 01-12.62-6.93v-.15H26.82v25.52a23.04 23.04 0 0023.01 23.01 23.04 23.04 0 0023.02-23.01zm1.8-27.33v27.33A24.85 24.85 0 0149.84 95a24.85 24.85 0 01-24.82-24.82V42.85a24.85 24.85 0 0124.82-24.82 24.85 24.85 0 0124.83 24.82zM57.98 29.88v9.36a.45.45 0 11-.9 0v-9.36a7.28 7.28 0 00-3.4-6.17.45.45 0 01.49-.76 8.18 8.18 0 013.8 6.93z"/><!-- Created by Icon Island from the Noun Project --></svg>
`,de=class hs{constructor(){this.$=hs.IDLE}is(...t){return t.some(i=>this.$&i)}set(t){this.$=t}add(t){this.$|=t}remove(t){this.$&=~t}};de.IDLE=0;de.CLICK=1;de.MOVING=2;de.INERTIA=4;var w=de,gr=class extends le{constructor(e){super(e),this.data={startMouseX:0,startMouseY:0,mouseX:0,mouseY:0,mouseHistory:[],pinchDist:0,ctrlKeyDown:!1,dblclickData:null,dblclickTimeout:null,longtouchTimeout:null,twofingersTimeout:null,ctrlZoomTimeout:null},this.step=new w,this.keyHandler=new Oe,this.resizeObserver=new ResizeObserver(Be(()=>this.viewer.autoSize(),50)),this.moveThreshold=ct*_.pixelRatio}init(){window.addEventListener("keydown",this,{passive:!1}),window.addEventListener("keyup",this),this.viewer.container.addEventListener("mousedown",this),window.addEventListener("mousemove",this,{passive:!1}),window.addEventListener("mouseup",this),this.viewer.container.addEventListener("touchstart",this,{passive:!1}),window.addEventListener("touchmove",this,{passive:!1}),window.addEventListener("touchend",this,{passive:!1}),this.viewer.container.addEventListener("wheel",this,{passive:!1}),document.addEventListener(_.fullscreenEvent,this),this.resizeObserver.observe(this.viewer.container)}destroy(){window.removeEventListener("keydown",this),window.removeEventListener("keyup",this),this.viewer.container.removeEventListener("mousedown",this),window.removeEventListener("mousemove",this),window.removeEventListener("mouseup",this),this.viewer.container.removeEventListener("touchstart",this),window.removeEventListener("touchmove",this),window.removeEventListener("touchend",this),this.viewer.container.removeEventListener("wheel",this),document.removeEventListener(_.fullscreenEvent,this),this.resizeObserver.disconnect(),clearTimeout(this.data.dblclickTimeout),clearTimeout(this.data.longtouchTimeout),clearTimeout(this.data.twofingersTimeout),clearTimeout(this.data.ctrlZoomTimeout),super.destroy()}handleEvent(e){switch(e.type){case"keydown":this.__onKeyDown(e);break;case"keyup":this.__onKeyUp();break;case"mousemove":this.__onMouseMove(e);break;case"mouseup":this.__onMouseUp(e);break;case"touchmove":this.__onTouchMove(e);break;case"touchend":this.__onTouchEnd(e);break;case _.fullscreenEvent:this.__onFullscreenChange();break}if(!Xe(e.target,"."+he))switch(e.type){case"mousedown":this.__onMouseDown(e);break;case"touchstart":this.__onTouchStart(e);break;case"wheel":this.__onMouseWheel(e);break}}__onKeyDown(e){var i;if(this.config.mousewheelCtrlKey&&(this.data.ctrlKeyDown=e.key===b.Control,this.data.ctrlKeyDown&&(clearTimeout(this.data.ctrlZoomTimeout),this.viewer.overlay.hide(T.CTRL_ZOOM))),!this.viewer.dispatchEvent(new W(e.key))||!this.state.keyboardEnabled)return;const t=(i=this.config.keyboardActions)==null?void 0:i[e.key];if(typeof t=="function")t(this.viewer),e.preventDefault();else if(t&&!this.keyHandler.pending){switch(t!=="ZOOM_IN"&&t!=="ZOOM_OUT"&&this.viewer.stopAll(),t){case"ROTATE_UP":this.viewer.dynamics.position.roll({pitch:!1});break;case"ROTATE_DOWN":this.viewer.dynamics.position.roll({pitch:!0});break;case"ROTATE_RIGHT":this.viewer.dynamics.position.roll({yaw:!1});break;case"ROTATE_LEFT":this.viewer.dynamics.position.roll({yaw:!0});break;case"ZOOM_IN":this.viewer.dynamics.zoom.roll(!1);break;case"ZOOM_OUT":this.viewer.dynamics.zoom.roll(!0);break}this.keyHandler.down(),e.preventDefault()}}__onKeyUp(){this.data.ctrlKeyDown=!1,this.state.keyboardEnabled&&this.keyHandler.up(()=>{this.viewer.dynamics.position.stop(),this.viewer.dynamics.zoom.stop(),this.viewer.resetIdleTimer()})}__onMouseDown(e){this.step.add(w.CLICK),this.data.startMouseX=e.clientX,this.data.startMouseY=e.clientY}__onMouseUp(e){this.step.is(w.CLICK,w.MOVING)&&this.__stopMove(e.clientX,e.clientY,e.target,e.button===2)}__onMouseMove(e){this.config.mousemove&&this.step.is(w.CLICK,w.MOVING)&&(e.preventDefault(),this.__doMove(e.clientX,e.clientY)),this.__handleObjectsEvents(e)}__onTouchStart(e){e.touches.length===1?(this.step.add(w.CLICK),this.data.startMouseX=e.touches[0].clientX,this.data.startMouseY=e.touches[0].clientY,this.data.longtouchTimeout||(this.data.longtouchTimeout=setTimeout(()=>{const t=e.touches[0];this.__stopMove(t.clientX,t.clientY,t.target,!0),this.data.longtouchTimeout=null},dt))):e.touches.length===2&&(this.step.set(w.IDLE),this.__cancelLongTouch(),this.config.mousemove&&(this.__cancelTwoFingersOverlay(),this.__startMoveZoom(e),e.preventDefault()))}__onTouchEnd(e){if(this.__cancelLongTouch(),this.step.is(w.CLICK,w.MOVING)){if(e.preventDefault(),this.__cancelTwoFingersOverlay(),e.touches.length===1)this.__stopMove(this.data.mouseX,this.data.mouseY);else if(e.touches.length===0){const t=e.changedTouches[0];this.__stopMove(t.clientX,t.clientY,t.target)}}}__onTouchMove(e){if(this.__cancelLongTouch(),!!this.config.mousemove)if(e.touches.length===1){if(this.config.touchmoveTwoFingers)this.step.is(w.CLICK)&&!this.data.twofingersTimeout&&(this.data.twofingersTimeout=setTimeout(()=>{this.viewer.overlay.show({id:T.TWO_FINGERS,image:mr,title:this.config.lang.twoFingers})},ut));else if(this.step.is(w.CLICK,w.MOVING)){e.preventDefault();const t=e.touches[0];this.__doMove(t.clientX,t.clientY)}}else this.__doMoveZoom(e),this.__cancelTwoFingersOverlay()}__cancelLongTouch(){this.data.longtouchTimeout&&(clearTimeout(this.data.longtouchTimeout),this.data.longtouchTimeout=null)}__cancelTwoFingersOverlay(){this.config.touchmoveTwoFingers&&(this.data.twofingersTimeout&&(clearTimeout(this.data.twofingersTimeout),this.data.twofingersTimeout=null),this.viewer.overlay.hide(T.TWO_FINGERS))}__onMouseWheel(e){if(!this.config.mousewheel||!e.deltaY)return;if(this.config.mousewheelCtrlKey&&!this.data.ctrlKeyDown){this.viewer.overlay.show({id:T.CTRL_ZOOM,image:wr,title:this.config.lang.ctrlZoom}),clearTimeout(this.data.ctrlZoomTimeout),this.data.ctrlZoomTimeout=setTimeout(()=>this.viewer.overlay.hide(T.CTRL_ZOOM),pt);return}e.preventDefault(),e.stopPropagation();const t=e.deltaY/Math.abs(e.deltaY)*5*this.config.zoomSpeed;t!==0&&this.viewer.dynamics.zoom.step(-t,5)}__onFullscreenChange(){const e=this.viewer.isFullscreenEnabled();this.config.keyboard==="fullscreen"&&(e?this.viewer.startKeyboardControl():this.viewer.stopKeyboardControl()),this.viewer.dispatchEvent(new Q(e))}__resetMove(){this.step.set(w.IDLE),this.data.mouseX=0,this.data.mouseY=0,this.data.startMouseX=0,this.data.startMouseY=0,this.data.mouseHistory.length=0}__startMoveZoom(e){this.viewer.stopAll(),this.__resetMove();const t=ke(e);this.step.set(w.MOVING),{distance:this.data.pinchDist,center:{x:this.data.mouseX,y:this.data.mouseY}}=t,this.__logMouseMove(this.data.mouseX,this.data.mouseY)}__stopMove(e,t,i,s=!1){this.step.is(w.MOVING)?this.config.moveInertia?(this.__logMouseMove(e,t),this.__stopMoveInertia(e,t)):(this.__resetMove(),this.viewer.resetIdleTimer()):(this.step.is(w.CLICK)&&!this.__moveThresholdReached(e,t)&&this.__doClick(e,t,i,s),this.step.remove(w.CLICK),this.step.is(w.INERTIA)||(this.__resetMove(),this.viewer.resetIdleTimer()))}__stopMoveInertia(e,t){const s=new ws(this.data.mouseHistory.map(([,a,h])=>new nt(a,h))).getTangent(1),r=this.data.mouseHistory.reduce(({total:a,prev:h},l)=>({total:h?a+Ye({x:h[1],y:h[2]},{x:l[1],y:l[2]})/(l[0]-h[0]):0,prev:l}),{total:0,prev:null}).total/this.data.mouseHistory.length;if(!r){this.__resetMove(),this.viewer.resetIdleTimer();return}this.step.set(w.INERTIA);let o=e,n=t;this.state.animation=new oe({properties:{speed:{start:r,end:0}},duration:1e3,easing:"outQuad",onTick:a=>{o+=a.speed*s.x*3*_.pixelRatio,n+=a.speed*s.y*3*_.pixelRatio,this.__applyMove(o,n)}}),this.state.animation.then(a=>{this.state.animation=null,a&&(this.__resetMove(),this.viewer.resetIdleTimer())})}__doClick(e,t,i,s=!1){const r=this.viewer.container.getBoundingClientRect(),o=e-r.left,n=t-r.top,a=this.viewer.renderer.getIntersections({x:o,y:n}),h=a.find(l=>l.object.userData[j]);if(h){const l=this.viewer.dataHelper.vector3ToSphericalCoords(h.point),p={rightclick:s,target:i,clientX:e,clientY:t,viewerX:o,viewerY:n,yaw:l.yaw,pitch:l.pitch,objects:a.map(y=>y.object).filter(y=>!y.userData[j])};try{const y=this.viewer.dataHelper.sphericalCoordsToTextureCoords(p);p.textureX=y.textureX,p.textureY=y.textureY}catch{p.textureX=NaN,p.textureY=NaN}this.data.dblclickTimeout?(Math.abs(this.data.dblclickData.clientX-p.clientX)<this.moveThreshold&&Math.abs(this.data.dblclickData.clientY-p.clientY)<this.moveThreshold&&this.viewer.dispatchEvent(new qt(this.data.dblclickData)),clearTimeout(this.data.dblclickTimeout),this.data.dblclickTimeout=null,this.data.dblclickData=null):(this.viewer.dispatchEvent(new $t(p)),this.data.dblclickData=re(p),this.data.dblclickTimeout=setTimeout(()=>{this.data.dblclickTimeout=null,this.data.dblclickData=null},lt))}}__handleObjectsEvents(e){if(!Mt(this.state.objectsObservers)&&yt(e.target,this.viewer.container)){const t=Et(this.viewer.container),i={x:e.clientX-t.x,y:e.clientY-t.y},s=this.viewer.renderer.getIntersections(i),r=(o,n,a)=>{this.viewer.dispatchEvent(new a(e,o,i,n))};for(const[o,n]of Object.entries(this.state.objectsObservers)){const a=s.find(h=>h.object.userData[o]);a?(n&&a.object!==n&&(r(n,o,Ne),this.state.objectsObservers[o]=null),n?r(a.object,o,qi):(this.state.objectsObservers[o]=a.object,r(a.object,o,$i))):n&&(r(n,o,Ne),this.state.objectsObservers[o]=null)}}}__doMove(e,t){this.step.is(w.CLICK)&&this.__moveThresholdReached(e,t)?(this.viewer.stopAll(),this.__resetMove(),this.step.set(w.MOVING),this.data.mouseX=e,this.data.mouseY=t,this.__logMouseMove(e,t)):this.step.is(w.MOVING)&&(this.__applyMove(e,t),this.__logMouseMove(e,t))}__moveThresholdReached(e,t){return Math.abs(e-this.data.startMouseX)>=this.moveThreshold||Math.abs(t-this.data.startMouseY)>=this.moveThreshold}__applyMove(e,t){const i={yaw:this.config.moveSpeed*((e-this.data.mouseX)/this.state.size.width)*E.degToRad(this.state.littlePlanet?90:this.state.hFov),pitch:this.config.moveSpeed*((t-this.data.mouseY)/this.state.size.height)*E.degToRad(this.state.littlePlanet?90:this.state.vFov)},s=this.viewer.getPosition();this.viewer.rotate({yaw:s.yaw-i.yaw,pitch:s.pitch+i.pitch}),this.data.mouseX=e,this.data.mouseY=t}__doMoveZoom(e){if(this.step.is(w.MOVING)){e.preventDefault();const t=ke(e),i=(t.distance-this.data.pinchDist)/_.pixelRatio*this.config.zoomSpeed;this.viewer.zoom(this.viewer.getZoomLevel()+i),this.__doMove(t.center.x,t.center.y),this.data.pinchDist=t.distance}}__logMouseMove(e,t){const i=Date.now(),s=this.data.mouseHistory.length?this.data.mouseHistory[this.data.mouseHistory.length-1]:[0,-1,-1];s[1]===e&&s[2]===t?s[0]=i:i===s[0]?(s[1]=e,s[2]=t):this.data.mouseHistory.push([i,e,t]);let r=null;for(let o=0;o<this.data.mouseHistory.length;)this.data.mouseHistory[o][0]<i-Ie?this.data.mouseHistory.splice(o,1):r&&this.data.mouseHistory[o][0]-r>Ie/10?(this.data.mouseHistory.splice(0,o),o=0,r=this.data.mouseHistory[o][0]):(r=this.data.mouseHistory[o][0],o++)}},pe=new nt,yr=class extends le{constructor(e){super(e),this.renderer=new gs(this.config.rendererParameters),this.renderer.setPixelRatio(_.pixelRatio),this.renderer.outputColorSpace=ys,this.renderer.domElement.className="psv-canvas",this.scene=new Qe,this.camera=new Es(50,16/9,.1,2*ae),this.camera.matrixWorldAutoUpdate=!1,this.mesh=this.viewer.adapter.createMesh(),this.mesh.userData={[j]:!0},this.meshContainer=new Je,this.meshContainer.add(this.mesh),this.scene.add(this.meshContainer),this.raycaster=new bs,this.container=document.createElement("div"),this.container.className="psv-canvas-container",this.container.appendChild(this.renderer.domElement),this.viewer.container.appendChild(this.container),this.viewer.addEventListener(se.type,this),this.viewer.addEventListener(z.type,this),this.viewer.addEventListener(ee.type,this),this.viewer.addEventListener(O.type,this),this.hide()}get panoramaPose(){return this.mesh.rotation}get sphereCorrection(){return this.meshContainer.rotation}init(){this.show(),this.renderer.setAnimationLoop(e=>this.__renderLoop(e))}destroy(){this.renderer.setAnimationLoop(null),this.cleanScene(this.scene),this.viewer.container.removeChild(this.container),this.viewer.removeEventListener(se.type,this),this.viewer.removeEventListener(z.type,this),this.viewer.removeEventListener(ee.type,this),this.viewer.removeEventListener(O.type,this),super.destroy()}handleEvent(e){switch(e.type){case se.type:this.__onSizeUpdated();break;case z.type:this.__onZoomUpdated();break;case ee.type:this.__onPositionUpdated();break;case O.type:e.containsOptions("fisheye")&&this.__onPositionUpdated(),e.containsOptions("canvasBackground")&&(this.container.style.background=this.config.canvasBackground);break}}hide(){this.container.style.opacity="0"}show(){this.container.style.opacity="1"}setCustomRenderer(e){e?this.customRenderer=e(this.renderer):this.customRenderer=null,this.viewer.needsUpdate()}__onSizeUpdated(){this.renderer.setSize(this.state.size.width,this.state.size.height),this.camera.aspect=this.state.aspect,this.camera.updateProjectionMatrix(),this.viewer.needsUpdate()}__onZoomUpdated(){this.camera.fov=this.state.vFov,this.camera.updateProjectionMatrix(),this.viewer.needsUpdate()}__onPositionUpdated(){this.camera.position.set(0,0,0),this.camera.lookAt(this.state.direction),this.config.fisheye&&this.camera.position.copy(this.state.direction).multiplyScalar(this.config.fisheye/2).negate(),this.camera.updateMatrixWorld(),this.viewer.needsUpdate()}__renderLoop(e){const t=this.timestamp?e-this.timestamp:0;this.timestamp=e,this.viewer.dispatchEvent(new Ft(e,t)),this.viewer.dynamics.update(t),(this.state.needsUpdate||this.state.continuousUpdateCount>0)&&((this.customRenderer||this.renderer).render(this.scene,this.camera),this.viewer.dispatchEvent(new Li),this.state.needsUpdate=!1)}setTexture(e){this.viewer.adapter.constructor.supportsOverlay&&this.setOverlay(null,0),this.state.textureData&&this.viewer.adapter.disposeTexture(this.state.textureData),this.state.textureData=e,this.state.panoData=e.panoData,this.viewer.adapter.setTexture(this.mesh,e),this.viewer.needsUpdate()}setOverlay(e,t){this.state.overlayData&&this.viewer.adapter.disposeTexture(this.state.overlayData),this.state.overlayData=e,this.viewer.adapter.setOverlay(this.mesh,e,t),this.viewer.needsUpdate()}setPanoramaPose(e,t=this.mesh){const i=this.viewer.dataHelper.cleanPanoramaPose(e);t.rotation.set(-i.tilt,-i.pan,-i.roll,"ZXY")}setSphereCorrection(e,t=this.meshContainer){const i=this.viewer.dataHelper.cleanSphereCorrection(e);t.rotation.set(i.tilt,i.pan,i.roll,"ZXY")}transition(e,t){const i=!S(t.position),s=!S(t.zoom),r=new De(i?this.viewer.dataHelper.cleanPosition(t.position):void 0,t.zoom);this.viewer.dispatchEvent(r);const o=new Je,n=this.viewer.adapter.createMesh(.5);if(this.viewer.adapter.setTexture(n,e,!0),this.viewer.adapter.setTextureOpacity(n,0),this.setPanoramaPose(e.panoData,n),this.setSphereCorrection(t.sphereCorrection,o),i&&t.transition==="fade-only"){const p=this.viewer.getPosition(),y=new X(0,1,0);o.rotateOnWorldAxis(y,r.position.yaw-p.yaw);const d=new X(0,1,0).cross(this.camera.getWorldDirection(new X)).normalize();o.rotateOnWorldAxis(d,r.position.pitch-p.pitch)}o.add(n),this.scene.add(o),this.renderer.setRenderTarget(new _s),this.renderer.render(this.scene,this.camera),this.renderer.setRenderTarget(null);const{duration:a,properties:h}=this.viewer.dataHelper.getAnimationProperties(t.transition,t.transition===!0?r.position:null,r.zoomLevel),l=new oe({properties:{...h,opacity:{start:0,end:1}},duration:a,easing:"inOutCubic",onTick:p=>{this.viewer.adapter.setTextureOpacity(n,p.opacity),i&&t.transition===!0&&this.viewer.dynamics.position.setValue({yaw:p.yaw,pitch:p.pitch}),s&&this.viewer.dynamics.zoom.setValue(p.zoom),this.viewer.needsUpdate()}});return l.then(p=>{p?(this.setTexture(e),this.viewer.adapter.setTextureOpacity(this.mesh,1),this.setPanoramaPose(e.panoData),this.setSphereCorrection(t.sphereCorrection),i&&t.transition==="fade-only"&&this.viewer.rotate(t.position)):this.viewer.adapter.disposeTexture(e),this.scene.remove(o),n.geometry.dispose(),n.geometry=null}),l}getIntersections(e){var i;pe.x=2*e.x/this.state.size.width-1,pe.y=-2*e.y/this.state.size.height+1,this.raycaster.setFromCamera(pe,this.camera);const t=this.raycaster.intersectObjects(this.scene.children,!0).filter(s=>s.object.isMesh&&!!s.object.userData);return(i=this.customRenderer)!=null&&i.getIntersections&&t.push(...this.customRenderer.getIntersections(this.raycaster,pe)),t}addObject(e){this.scene.add(e)}removeObject(e){this.scene.remove(e)}cleanScene(e){e.traverse(t=>{t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(i=>{i.map&&i.map.dispose(),i.dispose()}):(t.material.map&&t.material.map.dispose(),t.material.dispose())),t.dispose&&!(t instanceof Qe)&&t.dispose(),t!==e&&this.cleanScene(t)})}},Er=class extends le{constructor(e){super(e),this.fileLoader=new Ts,this.fileLoader.setResponseType("blob"),this.imageLoader=new Os,this.config.withCredentials&&(this.fileLoader.setWithCredentials(!0),this.imageLoader.setCrossOrigin("use-credentials"))}destroy(){this.abortLoading(),super.destroy()}abortLoading(){}loadFile(e,t,i){const s=Z.get(e,i);if(s){if(s instanceof Blob)return t==null||t(100),Promise.resolve(s);Z.remove(e,i)}return this.config.requestHeaders&&this.fileLoader.setRequestHeader(this.config.requestHeaders(e)),new Promise((r,o)=>{let n=0;t==null||t(n),this.fileLoader.load(e,a=>{n=100,t==null||t(n),Z.add(e,i,a),r(a)},a=>{if(a.lengthComputable){const h=a.loaded/a.total*100;h>n&&(n=h,t==null||t(n))}},a=>{o(a)})})}loadImage(e,t,i){const s=Z.get(e,i);return s?(t==null||t(100),s instanceof Blob?this.blobToImage(s):Promise.resolve(s)):!t&&!this.config.requestHeaders?this.imageLoader.loadAsync(e).then(r=>(Z.add(e,i,r),r)):this.loadFile(e,t,i).then(r=>this.blobToImage(r))}blobToImage(e){return new Promise((t,i)=>{const s=document.createElement("img");s.onload=()=>{URL.revokeObjectURL(s.src),t(s)},s.onerror=i,s.src=URL.createObjectURL(e)})}preloadPanorama(e){return this.viewer.adapter.supportsPreload(e)?this.viewer.adapter.loadTexture(e):Promise.reject(new v("Current adapter does not support preload"))}},br=class extends le{constructor(e){super(e),this.zoom=new fe(t=>{this.viewer.state.vFov=this.viewer.dataHelper.zoomLevelToFov(t),this.viewer.state.hFov=this.viewer.dataHelper.vFovToHFov(this.viewer.state.vFov),this.viewer.dispatchEvent(new z(t))},{defaultValue:this.viewer.config.defaultZoomLvl,min:0,max:100,wrap:!1}),this.position=new Rt(t=>{this.viewer.dataHelper.sphericalCoordsToVector3(t,this.viewer.state.direction),this.viewer.dispatchEvent(new ee(t))},{yaw:new fe(null,{defaultValue:this.config.defaultYaw,min:0,max:2*Math.PI,wrap:!0}),pitch:new fe(null,{defaultValue:this.config.defaultPitch,min:this.viewer.state.littlePlanet?0:-Math.PI/2,max:this.viewer.state.littlePlanet?Math.PI*2:Math.PI/2,wrap:this.viewer.state.littlePlanet})}),this.updateSpeeds()}updateSpeeds(){this.zoom.setSpeed(this.config.zoomSpeed*50),this.position.setSpeed(E.degToRad(this.config.moveSpeed*50))}update(e){this.zoom.update(e),this.position.update(e)}},_r=class{constructor(){this.ready=!1,this.needsUpdate=!1,this.continuousUpdateCount=0,this.keyboardEnabled=!1,this.direction=new X(0,0,ae),this.vFov=60,this.hFov=60,this.aspect=1,this.animation=null,this.transitionAnimation=null,this.loadingPromise=null,this.littlePlanet=!1,this.idleTime=-1,this.objectsObservers={},this.size={width:0,height:0},this.panoData={fullWidth:0,fullHeight:0,croppedWidth:0,croppedHeight:0,croppedX:0,croppedY:0,poseHeading:0,posePitch:0,poseRoll:0}}},Tr=class extends Pt{constructor(e){var t,i,s;super(),this.plugins={},this.children=[],this.onResize=Be(()=>this.navbar.autoSize(),500),Z.init(),_.load(),this.state=new _r,this.config=or(e),this.parent=gt(e.container),this.parent[j]=this,this.container=document.createElement("div"),this.container.classList.add("psv-container"),this.parent.appendChild(this.container),kt(this.container,"core"),this.adapter=new this.config.adapter[0](this,this.config.adapter[1]),this.renderer=new yr(this),this.textureLoader=new Er(this),this.eventsHandler=new gr(this),this.dataHelper=new fr(this),this.dynamics=new br(this),(i=(t=this.adapter).init)==null||i.call(t),this.loader=new hr(this),this.navbar=new ar(this),this.panel=new ur(this),this.notification=new cr(this),this.overlay=new lr(this),this.resize(this.config.size),this.setCursor(null),Ze(_.isTouchEnabled,r=>{be(this.container,"psv--is-touch",r)}),this.config.plugins.forEach(([r,o])=>{this.plugins[r.id]=new r(this,o)});for(const r of Object.values(this.plugins))(s=r.init)==null||s.call(r);this.config.navbar&&this.navbar.setButtons(this.config.navbar),this.state.loadingPromise||(this.config.panorama?this.setPanorama(this.config.panorama):this.loader.show())}destroy(){this.stopAll(),this.stopKeyboardControl(),this.exitFullscreen();for(const[e,t]of Object.entries(this.plugins))t.destroy(),delete this.plugins[e];this.children.slice().forEach(e=>e.destroy()),this.children.length=0,this.eventsHandler.destroy(),this.renderer.destroy(),this.textureLoader.destroy(),this.dataHelper.destroy(),this.adapter.destroy(),this.dynamics.destroy(),this.parent.removeChild(this.container),delete this.parent[j]}init(){this.eventsHandler.init(),this.renderer.init(),this.config.navbar&&(this.container.classList.add("psv--has-navbar"),this.navbar.show()),this.config.keyboard==="always"&&this.startKeyboardControl(),this.resetIdleTimer(),this.state.ready=!0,this.dispatchEvent(new te)}resetIdleTimer(){this.state.idleTime=performance.now()}disableIdleTimer(){this.state.idleTime=-1}getPlugin(e){if(typeof e=="string")return this.plugins[e];{const t=Ue(e);return t?this.plugins[t.id]:null}}getPosition(){return this.dataHelper.cleanPosition(this.dynamics.position.current)}getZoomLevel(){return this.dynamics.zoom.current}getSize(){return{...this.state.size}}isFullscreenEnabled(){return bt(this.parent)}needsUpdate(){this.state.needsUpdate=!0}needsContinuousUpdate(e){e?this.state.continuousUpdateCount++:this.state.continuousUpdateCount>0&&this.state.continuousUpdateCount--}autoSize(){(this.container.clientWidth!==this.state.size.width||this.container.clientHeight!==this.state.size.height)&&(this.state.size.width=Math.round(this.container.clientWidth),this.state.size.height=Math.round(this.container.clientHeight),this.state.aspect=this.state.size.width/this.state.size.height,this.state.hFov=this.dataHelper.vFovToHFov(this.state.vFov),this.dispatchEvent(new se(this.getSize())),this.onResize())}setPanorama(e,t={}){var n;this.textureLoader.abortLoading(),(n=this.state.transitionAnimation)==null||n.cancel(),this.state.ready||["sphereCorrection","panoData","overlay","overlayOpacity"].forEach(a=>{a in t||(t[a]=this.config[a])}),we(t)&&(g("PanoramaOptions.yaw and PanoramaOptions.pitch are deprecated, use PanoramaOptions.position instead"),t.position=this.dataHelper.cleanPosition(t)),typeof t.transition=="number"&&(g("Use PanoramaOptions.speed to define the speed/duration of the transition"),t.speed=t.transition,t.transition=!0),t.transition===void 0&&(t.transition=!0),t.speed===void 0&&(t.speed=at),t.showLoader===void 0&&(t.showLoader=!0),t.caption===void 0&&(t.caption=this.config.caption),t.description===void 0&&(t.description=this.config.description),!t.panoData&&typeof this.config.panoData=="function"&&(t.panoData=this.config.panoData);const i=!S(t.position),s=!S(t.zoom);(i||s)&&this.stopAll(),this.hideError(),this.resetIdleTimer(),this.config.panorama=e,this.config.caption=t.caption,this.config.description=t.description;const r=a=>{if(this.loader.hide(),this.state.loadingPromise=null,Ct(a))return!1;if(a)throw this.navbar.setCaption(""),this.showError(this.config.lang.loadError),console.error(a),this.dispatchEvent(new yi(e,a)),a;return this.setOverlay(t.overlay,t.overlayOpacity),this.navbar.setCaption(this.config.caption),!0};this.navbar.setCaption(`<em>${this.config.loadingTxt||""}</em>`),(t.showLoader||!this.state.ready)&&this.loader.show();const o=this.adapter.loadTexture(this.config.panorama,t.panoData).then(a=>{if(a.panorama!==this.config.panorama)throw this.adapter.disposeTexture(a),Re();return a});return!t.transition||!this.state.ready||!this.adapter.supportsTransition(this.config.panorama)?this.state.loadingPromise=o.then(a=>{this.renderer.show(),this.renderer.setTexture(a),this.renderer.setPanoramaPose(a.panoData),this.renderer.setSphereCorrection(t.sphereCorrection),this.state.ready||this.init(),this.dispatchEvent(new ze(a)),s&&this.zoom(t.zoom),i&&this.rotate(t.position)}).then(()=>r(),a=>r(a)):this.state.loadingPromise=o.then(a=>(this.loader.hide(),this.dispatchEvent(new ze(a)),this.state.transitionAnimation=this.renderer.transition(a,t),this.state.transitionAnimation)).then(a=>{if(this.state.transitionAnimation=null,!a)throw Re()}).then(()=>r(),a=>r(a)),this.state.loadingPromise}setOverlay(e,t=this.config.overlayOpacity){const i=this.adapter.constructor.supportsOverlay;return e?i?this.adapter.loadTexture(e,s=>{const r=this.state.panoData,o=s.width/r.croppedWidth;return{fullWidth:o*r.fullWidth,fullHeight:o*r.fullHeight,croppedWidth:o*r.croppedWidth,croppedHeight:o*r.croppedHeight,croppedX:o*r.croppedX,croppedY:o*r.croppedY}},!1).then(s=>{this.renderer.setOverlay(s,t)}):Promise.reject(new v("Current adapter does not supports overlay")):(i&&this.renderer.setOverlay(null,0),Promise.resolve())}setOptions(e){const t={...this.config,...e};for(let[i,s]of Object.entries(e)){if(!(i in D)){g(`Unknown option ${i}`);continue}if(i in ot){g(ot[i]);continue}switch(i in Ve&&(s=Ve[i](s,{rawConfig:t,defValue:D[i]})),this.config[i]=s,i){case"mousemove":this.state.cursorOverride||this.setCursor(null);break;case"caption":this.navbar.setCaption(this.config.caption);break;case"size":this.resize(this.config.size);break;case"sphereCorrection":this.renderer.setSphereCorrection(this.config.sphereCorrection);break;case"navbar":case"lang":this.navbar.setButtons(this.config.navbar);break;case"moveSpeed":case"zoomSpeed":this.dynamics.updateSpeeds();break;case"minFov":case"maxFov":this.dynamics.zoom.setValue(this.dataHelper.fovToZoomLevel(this.state.vFov)),this.dispatchEvent(new z(this.getZoomLevel()));break;case"keyboard":this.config.keyboard==="always"?this.startKeyboardControl():this.stopKeyboardControl();break}}this.needsUpdate(),this.dispatchEvent(new O(Object.keys(e)))}setOption(e,t){this.setOptions({[e]:t})}showError(e){this.overlay.show({id:T.ERROR,image:vr,title:e,dissmisable:!1})}hideError(){this.overlay.hide(T.ERROR)}rotate(e){const t=new jt(this.dataHelper.cleanPosition(e));this.dispatchEvent(t),!t.defaultPrevented&&this.dynamics.position.setValue(t.position)}zoom(e){this.dynamics.zoom.setValue(e)}zoomIn(e=1){this.dynamics.zoom.step(e)}zoomOut(e=1){this.dynamics.zoom.step(-e)}animate(e){const t=we(e),i=!S(e.zoom),s=new De(t?this.dataHelper.cleanPosition(e):void 0,e.zoom);if(this.dispatchEvent(s),s.defaultPrevented)return;this.stopAll();const{duration:r,properties:o}=this.dataHelper.getAnimationProperties(e.speed,s.position,s.zoomLevel);return r?(this.state.animation=new oe({properties:o,duration:r,easing:"inOutSine",onTick:n=>{t&&this.dynamics.position.setValue({yaw:n.yaw,pitch:n.pitch}),i&&this.dynamics.zoom.setValue(n.zoom)}}),this.state.animation.then(()=>{this.state.animation=null,this.resetIdleTimer()}),this.state.animation):(t&&this.rotate(s.position),i&&this.zoom(s.zoomLevel),new oe(null))}stopAnimation(){return this.state.animation?(this.state.animation.cancel(),this.state.animation):Promise.resolve()}resize(e){const t=e;["width","height"].forEach(i=>{e&&t[i]&&(/^[0-9.]+$/.test(t[i])&&(t[i]+="px"),this.parent.style[i]=t[i])}),this.autoSize()}enterFullscreen(){this.isFullscreenEnabled()||_t(this.parent)}exitFullscreen(){this.isFullscreenEnabled()&&Tt()}toggleFullscreen(){this.isFullscreenEnabled()?this.exitFullscreen():this.enterFullscreen()}startKeyboardControl(){this.state.keyboardEnabled=!0}stopKeyboardControl(){this.state.keyboardEnabled=!1}createTooltip(e){return new pr(this,e)}setCursor(e){this.state.cursorOverride=e,e?this.container.style.cursor=e:this.container.style.cursor=this.config.mousemove?"move":"default"}observeObjects(e){this.state.objectsObservers[e]||(this.state.objectsObservers[e]=null)}unobserveObjects(e){delete this.state.objectsObservers[e]}stopAll(){return this.dispatchEvent(new Wi),this.disableIdleTimer(),this.stopAnimation()}};Se.enabled=!1;Ms.enabled=!1;const Or={moveSpeed:1,zoomSpeed:1,defaultZoomLvl:20,minFov:30,maxFov:90,loadingTxt:"加载中"},xr=$.forwardRef(({className:e,viewerRef:t,onReady:i,onClick:s,onDblclick:r,onZoomChange:o,onPositionChange:n,options:a},h)=>{const l=$.createRef(),p=$.useRef(null),y=$.useCallback(()=>{var c,m;(m=(c=(t||p).current)==null?void 0:c.destroy)==null||m.call(c)},[]);return $.useEffect(()=>{if(!l.current)return;const d=t||p,c=new Tr({...Or,...a,container:l.current});return d.current=c,c.addEventListener("ready",()=>{i&&i(c)},{once:!0}),c.addEventListener("click",m=>{s&&s(m,c)}),c.addEventListener("dblclick",m=>{r&&r(m,c)}),c.addEventListener("zoom-updated",m=>{o&&o(m,c)}),c.addEventListener("position-updated",m=>{n&&n(m.position.pitch,m.position.yaw,c)}),()=>{y()}},[l.current]),$.useImperativeHandle(h,()=>{const d=t||p;return{destroy:y,viewerRef:d,getPlugin(c){var m;return(m=d.current)==null?void 0:m.getPlugin(c)}}},[]),cs("div",{ref:l,className:e||"view-container"})});export{L as A,D,v as P,_ as S,Bs as T,rr as a,xr as b,Cs as c,N as d,Xs as e,nr as r,Us as u};
