import{R as w,j as b}from"./index-fb03fb25.js";import{u as h,d as l,P as m,S as p,c as y,b as _}from"./index-c79634e7.js";import{aP as T,a8 as A}from"./three.module-aafafa83.js";import{p as P}from"./index-491b6676.js";/*!
 * PhotoSphereViewer.CubemapAdapter 5.4.2
 * @copyright 2023 Damien "Mistic" Sorel
 * @licence MIT (https://opensource.org/licenses/MIT)
 */var S=[0,2,4,5,3,1],x=["left","right","top","bottom","back","front"];function v(t){return t&&typeof t=="object"&&x.every(r=>r in t)}function U(t){const r=[];if(t.length!==6)throw new m("A cubemap array must contain exactly 6 images.");for(let e=0;e<6;e++)r[e]=t[S[e]];return r}function g(t){const r=[];if(!v(t))throw new m("A cubemap object must contain exactly left, front, right, back, top, bottom images.");return x.forEach((e,a)=>{r[a]=t[e]}),r}var R=h.getConfigParser({flipTopBottom:!1,blur:!1}),d=class extends l{constructor(t,r){super(t),this.config=R(r)}supportsTransition(){return!0}supportsPreload(){return!0}async loadTexture(t){this.viewer.config.fisheye&&h.logWarn("fisheye effect with cubemap texture can generate distorsion");let r;Array.isArray(t)||v(t)?r={type:"separate",paths:t}:r=t;let e,a;switch(r.type){case"separate":{let i;Array.isArray(r.paths)?i=U(r.paths):i=g(r.paths),a=i[0],e=await this.loadTexturesSeparate(i,a);break}case"stripe":a=r.path,e=await this.loadTexturesStripe(r.path,r.order,a);break;case"net":a=r.path,e=await this.loadTexturesNet(r.path,a);break;default:throw new m("Invalid cubemap panorama, are you using the right adapter?")}return{panorama:t,texture:e,cacheKey:a}}loadTexturesSeparate(t,r){const e=[],a=[0,0,0,0,0,0];for(let i=0;i<6;i++)e.push(this.viewer.textureLoader.loadImage(t[i],s=>{a[i]=s,this.viewer.loader.setProgress(h.sum(a)/6)},r).then(s=>this.createCubemapTexture(s)));return Promise.all(e)}createCubemapTexture(t){if(t.width!==t.height&&h.logWarn("Invalid cubemap image, the width should equal the height"),this.config.blur||t.width>p.maxTextureWidth){const r=Math.min(1,p.maxCanvasWidth/t.width),e=document.createElement("canvas");e.width=t.width*r,e.height=t.height*r;const a=e.getContext("2d");return this.config.blur&&(a.filter=`blur(${e.width/512}px)`),a.drawImage(t,0,0,e.width,e.height),h.createTexture(e)}return h.createTexture(t)}async loadTexturesStripe(t,r=["left","front","right","back","top","bottom"],e){const a=await this.viewer.textureLoader.loadImage(t,o=>this.viewer.loader.setProgress(o),e);a.width!==a.height*6&&h.logWarn("Invalid cubemap image, the width should be six times the height");const i=Math.min(1,p.maxCanvasWidth/a.height),s=a.height*i,n={};for(let o=0;o<6;o++){const c=document.createElement("canvas");c.width=s,c.height=s;const f=c.getContext("2d");this.config.blur&&(f.filter="blur(1px)"),f.drawImage(a,a.height*o,0,a.height,a.height,0,0,s,s),n[r[o]]=h.createTexture(c)}return g(n)}async loadTexturesNet(t,r){const e=await this.viewer.textureLoader.loadImage(t,o=>this.viewer.loader.setProgress(o),r);e.width/4!==e.height/3&&h.logWarn("Invalid cubemap image, the width should be 4/3rd of the height");const a=Math.min(1,p.maxCanvasWidth/(e.width/4)),i=e.width/4*a,s=[[0,1/3],[1/2,1/3],[1/4,0],[1/4,2/3],[3/4,1/3],[1/4,1/3]],n=[];for(let o=0;o<6;o++){const c=document.createElement("canvas");c.width=i,c.height=i;const f=c.getContext("2d");this.config.blur&&(f.filter="blur(1px)"),f.drawImage(e,e.width*s[o][0],e.height*s[o][1],e.width/4,e.height/3,0,0,i,i),n[o]=h.createTexture(c)}return n}createMesh(t=1){const r=y.SPHERE_RADIUS*2*t,e=new T(r,r,r).scale(1,1,-1),a=[];for(let i=0;i<6;i++)a.push(l.createOverlayMaterial({additionalUniforms:{rotation:{value:0}},overrideVertexShader:`
uniform float rotation;
varying vec2 vUv;
const float mid = 0.5;
void main() {
  if (rotation == 0.0) {
    vUv = uv;
  } else {
    vUv = vec2(
      cos(rotation) * (uv.x - mid) + sin(rotation) * (uv.y - mid) + mid,
      cos(rotation) * (uv.y - mid) - sin(rotation) * (uv.x - mid) + mid
    );
  }
  gl_Position = projectionMatrix *  modelViewMatrix * vec4( position, 1.0 );
}`}));return new A(e,a)}setTexture(t,r){const{texture:e,panorama:a}=r,s=a.type==="net"?!this.config.flipTopBottom:this.config.flipTopBottom;for(let n=0;n<6;n++)s&&(n===2||n===3)&&this.__setUniform(t,n,"rotation",Math.PI),this.__setUniform(t,n,l.OVERLAY_UNIFORMS.panorama,e[n])}setOverlay(t,r,e){for(let a=0;a<6;a++)this.__setUniform(t,a,l.OVERLAY_UNIFORMS.overlayOpacity,e),r?this.__setUniform(t,a,l.OVERLAY_UNIFORMS.overlay,r.texture[a]):this.__setUniform(t,a,l.OVERLAY_UNIFORMS.overlay,null)}setTextureOpacity(t,r){for(let e=0;e<6;e++)this.__setUniform(t,e,l.OVERLAY_UNIFORMS.globalOpacity,r),t.material[e].transparent=r<1}disposeTexture(t){var r;(r=t.texture)==null||r.forEach(e=>e.dispose())}__setUniform(t,r,e,a){t.material[r].uniforms[e].value=a}};d.id="cubemap";d.supportsDownload=!1;d.supportsOverlay=!0;const u=P+"cube/";function O(){const t=w.createRef();return b(_,{ref:t,options:{adapter:d,panorama:{left:u+"tile_1.jpg",front:u+"tile_6.jpg",right:u+"tile_2.jpg",back:u+"tile_5.jpg",top:u+"tile_3.jpg",bottom:u+"tile_4.jpg"},size:{height:"100%",width:"100%"},navbar:!1}})}export{O as default};
